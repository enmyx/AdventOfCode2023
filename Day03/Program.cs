using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Day03
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var sinput = "467..114..\r\n...*......\r\n..35..633.\r\n......#...\r\n617*......\r\n.....+.58.\r\n..592.....\r\n......755.\r\n...$.*....\r\n.664.598..";
            var input = ".679.....662....71............................805..........862.680...................................................................687....\r\n............*....-..811..........846..855......*.............*..$........230.92@............................=.....................92........\r\n..........360..........#....664.....=.*...881...677...934.780.......426.*..........8......654.....*959.....539..........21.........*........\r\n.....................+.........*......379..*.........*.........=.........969........*........*.976..............872....*....../....579......\r\n.......566......652...809....482.394......492..303.650..../...38....%...............106...385..................#.....793..484.865...........\r\n......*...........*................*..347.......*.........220.....349...691...392*..................18..797.......................+.........\r\n.....11......890........870.......156............733.................../..........921.....................*......*.............203..........\r\n.............#...238.....*...........................188......294./58........408...............677.......778....104.903............%........\r\n.411+...828.......*.....706.....249..=.....638...848*...........%...............*948............*.....+......+...........917.......817...346\r\n................69.................*..310.*....@..........118*......428=..785...................931...217.....934....475...@.145........*...\r\n...844.885.........#66...........587.......74...773...........194......../.........&107................................%...............375..\r\n......*....826.190.......498........................960............24........212............................398...........474*925...........\r\n...........*...*......../......949.-...213./353.................................@...........853......33*164....+....998...............325...\r\n........640..823....957........&...746..*........*777.............134.......264.......904+..=........................*......./........%.....\r\n....43...............*....457............325..390...........618.........265....*670............=...#165........909..634.......810...........\r\n.....................503.*.....438..904*.............+.........*..563..*............345@......597.........758.*...................*154......\r\n...941...................612...@........691.....&...336.......837..*....489...............................*...462.689....995...106..........\r\n......*383..824...................911........*..467.................44....../.........&445...$...765.647..464.............&..........226....\r\n......................151.....116*........249..................929*.......500..140.........18.......*.........823.....454............*......\r\n..................968..@..........................118*.....300.................*....762.........541......59...*....35....*..........8.......\r\n.....304.........*.......620..@...573.878................................@...@.273.*......572...............661........527.971*.......259...\r\n....*.............83.....%...983.*......*.32..603.....201..............492.166.....339.....*...978$..............373...........340.....*....\r\n.761..758...934..................550.148.................................................25......................*.....*236.............624.\r\n........&......*...393..62*.................167/..716........$........910.767.......380............873*812.362.115..537......48.............\r\n.....#........697..*.......159.....................*.........522..............41.....*.........+............*...........812......13.........\r\n....529.............374......../...%.............................143...........*......109.......365..........952...........*....*...........\r\n...........122*...............555.937......674....................../...529.774..371.................#.38.........../.......304.750....715..\r\n..................873*....819..........165....*..928*345........................*..........77......478..*...440...743...................*...\r\n964...........417.....802..*......230..-....509..................573...........219...675....-.865.......13............25.62*4...980..145....\r\n....*556........&.............278*.................957.....85#.....*................*............=....#.....442........$.......*............\r\n.972.....................541...........91*614..485...............680..792...+........541.325..........486......&..653....#.....247..778.....\r\n.......680.................*.980*710............*...494...............*......88...........................825........#.629.............$....\r\n.399...*......439.........89...........430*....401.....*660....693......407&...........#883....#265......*.....438..........................\r\n........390....*.....388.........21........861............................................................798.-....#........................\r\n..417&.......551.102.$..............332............/804.....463*649..188.........992.....754.203....912..........732.490....................\r\n...................*................*......214.134......................*805.%.....*.....*....*.....#.....*..........*....302.....934..=....\r\n....835.........622..............8...541...*....*..861....442....874..........458...955...985..172.....497.310........341......$....*...644.\r\n....*......246......909....320.............893.150....*.....*....*........717................................................833.178........\r\n...622....*....309.+.........*.........681..........414......612..678....*...........336.................+.....715..........................\r\n...........407.......611.....42...........*159........................................*..97..............355...*..........*954..............\r\n.......967.....120..=...............................................................519....+.....382............974...................651...\r\n739.......*.....*........155.....539................132*.....702......@....923...............905*.........................971...............\r\n....453...149...717.400............*.........618........295.....#..644.......-...786....................*...287...........$.................\r\n...#..................*.............810........*.908$............................*......+........168...903.....*.....&.......@..............\r\n.................306...483..750.108..........570...................934......523..736..#..889......*.........557.......913....107.852..241...\r\n...............................*.......................899............*974..%........42............268...........807..............-...@.....\r\n..958.......610............/......................894.........................242.........300...........$............941..150...............\r\n...........#....131.907.....924...529.267............=.....-./.....692*505...*......265%............$...95.....538........#.................\r\n....137...............$...........*...*.........219.....347..268.............753....................12.....351.................955....875...\r\n......*....258.................854..253...15........................506....#.................559........&................&........*.........\r\n.....376...*.....892.466..160............*.......$................*....*..593.............../............682....721...750..10......187...540\r\n...........866...=..................$...437....994......730....404...703................507...&...........................*....126......@...\r\n....300...............301....@...315.....................*......................572........-...793.......309.518.437..182.310.*.....&.......\r\n...=.....-176.129*........882............................256...............249..*.....+.....................*.....%..+.........71...76..586.\r\n......54..........910............*......734....*..............-.......445.....@.....807.....75.907....477%..................................\r\n.....*........................247.855....%...647.....@.....558...407....#....................%...*................................447..129..\r\n......322..235.......821..............*...........767...............*35..........824.338.55....232...814................546*582.......*.....\r\n..............*........./...........509......270.......-33...673................/.......*..............*......-.....................257.....\r\n....793*831....805.871.....701..........503.....$............%.............710......37..../.........897...-....516.....330...371............\r\n....................*..324*............$............875........293.........*.........@..510..............332..............*..*....2*558.....\r\n.........../......147........373..........%926.........@......-......426...142...............%.......184.........#.....746..................\r\n.......589..755.......285............221+.................$.........*.................571.....539......*.....60...644.............333.......\r\n258....................*.....499............$.107......510.......257..........583.......@...........408.............................*.......\r\n.....................396......*.../..../..493.........................489*380....*........908.711............772..........561......24..559..\r\n.............................548.769.630..........504*........893................605.........*.........*..10................*..653.....*....\r\n........=418..........*576................-..............815.....*.389......481.........*.......859.180....................137..+....275....\r\n..77...........551.901.....535............683.............../.638............./......671.908.....@......360.....611....136..................\r\n...&...........*.......722...........................702.............514............................520.$.........*...&.....$315...#...147..\r\n.......830............*.............#377........39.....%.......384..*.........748..265......271.............885..882...............45...+...\r\n..329.-...........787.311.........................*........115...@..840.........&...*.......*......513..695..........515....................\r\n....*......666...*..............256*999......897.651.......*............457.........34..&...933...*......*......................156.........\r\n..627.......*....24...........@.........................177...22........*...775........668......685...947.....110................*..........\r\n.........172..........295*....540.856..76......................+...337.343.=.............................................18....914..449.....\r\n.............239..........163.........*......770....594.........../..............200.....824*513..........146............*..........-.......\r\n..............#................841...199......=............317..........97.*..........-.............165.....................................\r\n...570...../......................*.......122.......179#..*......138........647......376........65..............735.........................\r\n.....@.221..50..350...@....757.....88........*582.........893.....*.....230.................403...$......................865...927....892...\r\n..........*........#...130..*......................232.........709....&...........105......*..............926=.......966.*.......*...$......\r\n....200...884..............338....*155....822*609....&..84.........935..............#.....481...968.64................+..337.....152...254..\r\n.......*.........203............70......................%...................../................*....*........................627............\r\n.......491........*......321.......$...-.......282............................512.282........564.625........746*825..#..........*361........\r\n...................908...$........335.332.509$....*..../..........216.....-.......*...................617.............896...................\r\n......946...299............657..................255...724..../......*.....830..122..........487.........*.....645.................56.66.....\r\n..984..@...........@....15*.............*858...............150.....91..................498.........654..969.......+............&.....*......\r\n.........104.870.281.........$.......796.......................................................................853.............316..984.....\r\n.........*.....#......=...288.............86......376.804...515...............405..265*................................%....................\r\n.336....152..........671............545.....&......*.....*..............549...*........37.....-....313.#......110.....578..414*.............\r\n..............496.....................*...........536..20........471...*.......397..........437.....*..996...&....18...........200..........\r\n.................=..........308.....147...319.12................*.....465..............$992........71..............@........................\r\n............712.......*123.=..............#.....*629.......%..............................................#..........153..945...........36..\r\n.....+340.....-....850................922...%............812..259*577...#452...-........620.567-.784....985.934.427...@..*.........280......\r\n216............................394......*..589.........-.....................191....622./..........*........*.............124........*......\r\n......764......................*......663...............165...318.....................*....200.83...896..856................................\r\n.....*.......705........751..46...............................-....698....132.......-..81...........................264.....................\r\n...538.......*......170....*..............808........166..........+......$........130........428............852.......*.................902.\r\n..............803...........938..51....66.*...514.......*430..................................*......@..............=............/469.......\r\n.........26@.........90...................473..../..273..............13......656.......242$..829......682...........594...968...............\r\n...180............+.........872..131....................176...781...-.......*.....294.............990.............#..........=.@...../......\r\n....@..344.........184..........*.............................*.........42..153..#.................*.....577......32...........303..334.....\r\n........&..620..................821....172....32.....470....698..........%....................397..301.......................*..........569.\r\n.../........./.........325.@.............*...*.........*........$.....*....+......124...200......*.......827....*861........857.876.........\r\n..808.................*.....581..............644...3..190.607.175..76.712..724.......$........16.358......*...31.......270.........*915.....\r\n...............894...453...............845..........#.......*.....................#......................793..............*...914*..........\r\n..................&......................+...............99.596..597*813...958.831......261*95.....922..........&.......537.......302.414...\r\n...931*.................................................+..........................394......................65.679..........%.........*.....\r\n.......839....644......./262......461...424.....682........................954.............43*.............*.......778..*....464......822...\r\n.............#.......................=..*...........706....289*.....459......*..........-.....234........11..$.......@..373.................\r\n.............../620...536+....100*......907.....159..+.........998.*..........832.....806...........695.....516....................126......\r\n..................................268.............*....893.........12.86.................................................*..................\r\n......+....355.........998..630..............$.....815...*..............*.....168...554...........735............+......861....490..........\r\n.....176...*....513....%....*.................120......568....*314.404+.325..........*..662...855.....495.........467..........*............\r\n..........132......*......677..708.................424.....715.....................520..*..................................36.410...........\r\n..419...........454..............#...730...401&....*.....#............696..............267.=802...................761......*................\r\n............394.........................*........650...637....695......*.....................................586....-...735..154.....423*344\r\n........458..%.....*...728..+..........488.435......................241........795.552.....9.&...............................#..............\r\n...........*....86.981....*..633.........../................762.700.....70*.........../....*.837......-.........20..................%.......\r\n.519...+.652...*........614.......+....................924....*............663..591......192.....952.25.........*....600....#.*239..381.....\r\n...*.366.......845.512......@...200...-....280............*...207............................297...*......828...249.*.....408...............\r\n.189......5........*.....353........245.......#...153..680..............295..50...............+....296.../...........906.............+......\r\n......741*.........466....................710....=.........561*........*..............831............................................909....\r\n...........+.................421............*..........+.......661..103...............................922..752..................431.........\r\n181......218.707....*....273....*..130.$273.980.........656..............517..712..578.......&.524.....@....*.....996..............*....#709\r\n.................442.432..*....64.*......................................../..*....#.......534....*........498.............727.....434......\r\n233*559....................869.....316../..........&.....502..+...884.731.....503................239...499.....94..........*................\r\n........352.......231...................340.....177..584.....922.....*....57...........................*.........*349...222...212&...433.520\r\n...........-.........*981..479..637.....................*969.....*.........=..$.........601...=826...312....................................\r\n..............205.................*../...@.....213.............41.64..........80....889*.............................@....76.=702...........\r\n....353.......*..................114..97.867...*.....542.........................................721...395............816..............*112.\r\n....*.......367.*............478.............42..../..........947.................................*......@......956...........+...883.......\r\n.....870........460............*...................26...........*...........960......212...479....422...........*.......780..595..*.........\r\n....................978*368....921..760=..................416...665..$.........$.381*.......*............933.744....=..*...........792......\r\n....52..........300..........................................*........293.162%........................@...*........259..283.................\r\n......%..........%........119.......575.......#..%......./.748......................945...212&.....595.....248.286...........839..106/......\r\n..940........$...........%............%....880....539.659.............*.........353*.....................=.....*................*.......188.\r\n.....*....254...............794..550...............................701.797............500#................34..475...507..........763........\r\n..649............58..691&.....%............................................386..............@.$44.101.....................997..*............\r\n.........255............................376....732....-..............869......$...........473........*376....220.........@.....721...443....\r\n...........@.913.....168....=909..431......=......@..976.......+.......*..........155............................620.......250......@.......\r\n......806.....*....................*...........@................45.....475...724..*......&45.........+202..-576.....*.........*.............\r\n...............383...........................372..................................474...................................432.471......729....";

            var lines = input.Replace("\r\n", "\n").Split('\n');

            int sum = 0;
            var gears = new Dictionary<(int i, int j), List<int>>();
            for (int i = 0; i < lines.Length; i++)
            {
                int number = 0;
                (int i, int j) isPart = (-1, -1);

                string line = lines[i];
                for (int j = 0; j < line.Length; j++)
                {
                    if (char.IsDigit(line[j]))
                    {
                        number *= 10;
                        number += int.Parse(line[j].ToString());

                        if (i > 0 && j > 0 && Symbol(lines[i - 1][j - 1]))
                        {
                            isPart = (i - 1, j - 1);
                        }
                        if (i > 0 && Symbol(lines[i - 1][j]))
                        {
                            isPart = (i - 1, j);
                        }
                        if (i > 0 && j < line.Length - 2 && Symbol(lines[i - 1][j + 1]))
                        {
                            isPart = (i - 1, j + 1);
                        }
                        if (j > 0 && Symbol(lines[i][j - 1]))
                        {
                            isPart = (i, j - 1);
                        }
                        if (j < line.Length - 2 && Symbol(lines[i][j + 1]))
                        {
                            isPart = (i, j + 1);
                        }
                        if (i < lines.Length - 2 && j > 0 && Symbol(lines[i + 1][j - 1]))
                        {
                            isPart = (i + 1, j - 1);
                        }
                        if (i < lines.Length - 2 && Symbol(lines[i + 1][j]))
                        {
                            isPart = (i + 1, j);
                        }
                        if (i < lines.Length - 2 && j < line.Length - 2 && Symbol(lines[i + 1][j + 1]))
                        {
                            isPart = (i + 1, j + 1);
                        }

                        if (isPart != (-1, -1) && (j == (line.Length - 1) || !char.IsDigit(line[j + 1])))
                        {
                            //sum += number;
                            if (!gears.ContainsKey(isPart))
                                gears[isPart] = new List<int>();
                            gears[isPart].Add(number);

                            number = 0;
                            isPart = (-1, -1);
                        }
                    } else
                    {
                        number = 0;
                    }
                }
            }

            foreach (var gear in gears)
            {
                if (gear.Value.Count == 2)
                {
                    sum += gear.Value[0] * gear.Value[1];
                }
            }

            Console.WriteLine(sum);
        }

        private static bool Symbol(char c)
        {
            //return !char.IsDigit(c) && c != '.';
            return c == '*';
        }
    }
}
