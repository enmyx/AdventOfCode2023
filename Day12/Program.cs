using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Day12
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var sinput = "???.### 1,1,3\r\n.??..??...?##. 1,1,3\r\n?#?#?#?#?#?#?#? 1,3,1,6\r\n????.#...#... 4,1,1\r\n????.######..#####. 1,6,5\r\n?###???????? 3,2,1";
            var input = ".???##?????????#?.?? 1,12\r\n#####??.?????? 7,1\r\n#.???#???.#? 1,2,1,1\r\n?#???#?..???# 2,1,1,1\r\n?#..???.#?.?.. 1,2,2,1\r\n?#?????#?#??#?????# 2,1,8,1,1\r\n?#???????? 1,4,1\r\n#???#??#?##.???? 1,1,7,1,1\r\n?#?.#???#?###??? 2,3,8\r\n.??#????#. 3,1\r\n??#.??#??#?? 1,1,2,1\r\n?#??#?#??.?.#.#?? 8,1,1,3\r\n????###??#.???#..?? 7,3,1\r\n.##????.?? 3,2,1\r\n#.#???#?##??.????.? 1,2,7,1,2\r\n.#?.??#?????.??.?? 2,8,1\r\n#???..?.?. 3,1\r\n????#?#???..??? 1,6\r\n?????#???.??.???? 6,1,1,1,2\r\n?..?.#????#?###?#? 1,1,1,10\r\n.#??#?????#. 4,5\r\n.?????????. 1,4\r\n.??.?.#?#??. 1,4\r\n??##???.#???#??.? 5,3,2,1\r\n?#????#??.? 1,4,1\r\n#??#.??###???. 4,5,1\r\n?#?.#??.???# 3,2,3\r\n?#??.???#??? 1,1,5\r\n???.#????.? 2,4,1\r\n???#?.#??#???#?.?# 1,1,1,1,3,1\r\n???.#???.?#???? 1,1,3,2,1\r\n.#??##????. 5,2\r\n?????#???????.??? 3,4,1,1,3\r\n?...???####????#? 1,13\r\n.?##?#????????#???. 6,6\r\n???.?#???? 2,3,1\r\n.????????#???? 5,3,1\r\n..?#??..??.?? 4,1,1\r\n.?#???.?#? 2,1,1\r\n#??..???????#? 2,1,5\r\n??#????..??.???. 3,1,1,1\r\n..#??.????? 3,3\r\n.#?????#?..?.#?? 2,1,3,1,1\r\n##???..????? 4,2\r\n???????????#.? 1,5\r\n.#?#???????#???? 3,1,5,1,1\r\n?????#?????. 2,2,1\r\n?.?????###?? 2,4\r\n???????#???#?????? 1,1,7,1,1\r\n?#????##?????????? 9,1,1,1\r\n???????.??#????#? 6,2,1,1\r\n?#???..??????? 4,3,1\r\n.#?????#?# 4,4\r\n???????.???????. 2,3,2,3\r\n????#?#????????.??# 12,1,1,1\r\n.##..?.?##?#?.?.# 2,4,1,1\r\n#?##??#??.# 8,1\r\n?????.??#????? 1,1,6\r\n??.?..?#?.??. 1,2,2\r\n????#??..????? 2,1\r\n?.#???##???.? 1,1,2,1\r\n????????#?? 1,1,4\r\n?#???.??###????.? 4,5,1\r\n??.?.??#?#.???#???? 1,1,1,3,6,1\r\n.???#????????? 1,7\r\n?###????#?????.?#. 4,8,2\r\n?#?????????? 8,1\r\n?.#?#???###?.???? 1,8,1\r\n????#?.#???????.?? 1,8\r\n#????????.?#??# 2,1,1,2,1\r\n?.??.??#..?#.??? 1,1,2,2,2\r\n?????.#??.?? 1,3\r\n##??.?###????? 4,7\r\n?.?#?###??? 1,2,3\r\n.?????.???#? 2,4\r\n.??#.?##???#?? 1,5,1\r\n?##.??#????#???????# 3,5,1,1,1,2\r\n#??#???#.???###???? 1,1,2,5,1,1\r\n??.??.?????##?.?? 1,1,5,2\r\n.#??.??#???##?#.?#? 1,1,2,2,1,2\r\n??????####??##..?? 14,1\r\n????.??#?????#??... 1,1,6,1,1\r\n??#?.??.#.. 3,1\r\n.#?#????????.. 5,4\r\n???#?????#??#? 2,7\r\n????#?????#?#??#.? 8,1,1,1,1\r\n?#?????##.?????????? 9,1,1,1\r\n?#????.??#?#.??.# 1,1,5,1,1\r\n?????#?..? 1,3\r\n?.???#?#????##? 8,3\r\n???..?..??#?.#??##?. 2,1,4,6\r\n?###??.?#?#?????? 5,4,2\r\n?..##???????????? 4,5\r\n.??#.????????#..???? 1,6\r\n?###??????.????? 10,3\r\n?.#.??.?????#..??. 1,2,2,1,1,1\r\n??#???????#.# 8,1,1\r\n??.#?...?#????? 1,1,2,4\r\n.??????#????? 8,2\r\n?#?#??..??.??# 3,1,3\r\n.?????.????. 1,2\r\n?????..??????? 1,2,3,1\r\n..#?.??#.##??#??? 1,1,1,6\r\n????.?.?..? 2,1,1\r\n.#???.??.??? 1,1,1,1\r\n?.???#..??????? 1,3,6\r\n.?#.??..?? 1,1,1\r\n????????.#? 3,1\r\n???#?????? 1,2,2\r\n???#####???#?.?#.??. 12,1\r\n????..??.? 2,1\r\n.???????.???? 3,1,2,1\r\n??#?#???#??#??.???. 8,1,1,3\r\n?????###.???? 8,2\r\n.??..?.?#?? 2,3\r\n#?.????..? 1,2,1\r\n??????????##.#?#. 1,8,1,1\r\n.#????##??.?.#?? 1,1,4,1,2\r\n?###???.??.???.? 3,1,1,1,1\r\n.#?.?#???????? 2,1,2,3\r\n#???#?##???#?#??. 8,5\r\n.?#???????????.#?#? 4,2,3\r\n?##.??..??? 2,1\r\n?..???????????? 1,2,2,1,1\r\n.#?.??#??? 2,2\r\n???.???.???..#????? 2,2,1,1,3,1\r\n?#??????#. 3,4\r\n?.????#?#?????# 7,5\r\n??#????.?#??.. 2,2,3\r\n.#?????#??#??#??.?? 1,4,1,2,1,2\r\n???..?#???? 3,1,1\r\n#??#??????...?? 1,1,3,1,1\r\n?#??.?..#??????# 4,3,4\r\n??.??.??????.? 2,3,1\r\n..#?..?#???. 1,2\r\n.?????#?.? 3,1\r\n?#??#??#?#?#.??? 1,9\r\n##???.????.?#??.??? 4,1,1,3,1\r\n.?.?.?.????????? 1,1,4,1\r\n??.#????#.???##???.? 1,3,1,1,5,1\r\n#.??#?.?.?..? 1,2,1,1\r\n???.#?.???. 1,2,2\r\n?..#?.?#??????? 1,2,6\r\n#?.?##?#?? 1,3,1\r\n#?#.???#?#???.? 3,5,2,1\r\n##..?.????##?#?#???? 2,1,1,9,1\r\n.?#????.???? 2,4\r\n???..###?#??# 2,5,2\r\n#???.????#??? 4,2,1,1\r\n..?#??????..? 2,4\r\n??...????#.?? 1,3,1,1\r\n?.??##?#???.??????? 6,7\r\n???#?.?????#? 1,1,1,1\r\n??#?????????.??#?.?? 1,1,2,4,3\r\n?????#?#??#??????? 1,4,1,6,1\r\n?#???#.?#??? 2,1,1,3\r\n?##.??#?????.???. 2,3,3\r\n??#????.??? 1,5,1\r\n??##?????????????? 3,3,1,5\r\n???.?##????? 1,5,1\r\n?#??#.???#?????## 1,1,6,3\r\n.?.??#?.???#?? 2,4\r\n???##???.??????#???? 7,1,1,5\r\n??????#????.?..? 3,1,3,1,1\r\n?#??##???.???#.????# 7,1,1,1,1,1\r\n???????#.??? 1,6,2\r\n.#.?#?.?#? 1,1,1\r\n?#???#????#?.#?????? 10,1,2,1\r\n.?#?####??#???????. 6,9\r\n#?..?#.?#?#????#? 1,2,8\r\n.??#?##?.????#??#. 2,2,8\r\n????#..???????? 1,1,2,2\r\n??#???#..?##????? 1,2,1,8\r\n.????????##???. 6,4\r\n????#?...??.?.?#.# 5,1,1,1,1\r\n??.?????..#?? 1,1,1,3\r\n?????.???? 3,1\r\n.????????.??.???? 1,4,2,1,1\r\n?#??#???.????????? 7,2,2\r\n???#????.#.??##??? 4,1,4\r\n#??##..#?????. 1,2,2,1\r\n???????#???.?.?#?. 4,2,1,3\r\n??.???#.?.???. 2,3,3\r\n???.???#???.??##? 1,7,4\r\n????##.?#??##..?? 6,1,2,1\r\n.??.???#????#.?.? 2,1,3,2,1\r\n????????#?#?#? 2,5,4\r\n.???????.?#?#?. 5,5\r\n?.###???.???????##?? 5,1,1,6\r\n??????#??#??#???.#? 1,1,9,1\r\n?#???#.?????# 6,2,2\r\n???.#??????. 2,3,1\r\n.????##?????.? 9,1\r\n????#..#.??? 1,1,1,1\r\n?##?..???????????#.? 4,9\r\n?#?????.?? 3,2,2\r\n#??????#??????.? 8,1,2,1\r\n?#.?#?????#..#??? 2,4,2,1,1\r\n#????????????.#?? 1,6,2,3\r\n???#???.#.? 4,1\r\n?#??#?#.???#??????. 6,4,2\r\n??##???????#????.?# 1,8,1,2,2\r\n?#????#?#.???.?# 2,4,1,1\r\n?##????#?# 3,5\r\n?.?..??#.#?. 1,1,1,1\r\n?#.???????.?? 2,3\r\n?#???#????.? 8,1\r\n?#?.??????#. 1,6\r\n#?#.???.?? 3,3,1\r\n?.#?????????????#? 10,1\r\n???????#??.?#?? 2,4,2\r\n?#???##??##??#???#?? 8,2,1,3,1\r\n?#???#???##? 2,6\r\n??.???##?. 2,3\r\n?????????.???..?#?? 7,1,1,3\r\n.?#??..??#?? 4,3\r\n???.???#????.???? 1,5,2,1\r\n?#.???##???#.. 2,6\r\n?#?.???.??#??#.??.. 2,3,3,1,1\r\n?#???????##???.??#? 14,1\r\n#?.#????..?.? 1,1,2\r\n??..???????#?.??. 1,7,1\r\n?#??#??????#.????? 2,1,1,3,1,1\r\n?..??.??#?.?? 1,1,3,1\r\n????.??##?#?#??. 2,8\r\n??????##?#?? 1,1,7\r\n???##?.#?#??????#??? 3,13\r\n??#????#????.??. 3,1,2,1,1\r\n???.??????..?.? 2,1,1,1,1\r\n#???###???????. 1,6,2\r\n??#?#.##???.????##? 3,1,4,1,4\r\n?.????##????????##?? 4,7\r\n?.###?#.?#??#.??#??. 1,5,3,1,4\r\n.?.?#????? 1,1,3\r\n...??.???. 2,2\r\n.?????#??? 2,2\r\n??????##?#..?????#.? 4,4,1,1,2,1\r\n??##?#??.?.?? 6,1\r\n.???##????..??#???#? 5,7\r\n#???#????? 5,1,1\r\n????????#?. 3,5\r\n?.??#???##?.??? 1,1,1,5,2\r\n???????#?.?. 1,1,2,1\r\n?.##?#.??#?#?.. 4,6\r\n?##??????#.?????? 7,1,2,1,1\r\n?.??????..???.?..? 2,1\r\n?..?????#??? 2,2,1\r\n??#..????? 1,1,1\r\n???????#?.?? 9,1\r\n????#??.??. 6,1\r\n#.?....??????#?? 1,8\r\n?###?#?????##??? 13,1\r\n???.??.???##? 1,5\r\n##.?.?.?##??#?##???? 2,1,10,2\r\n?#??.?.?.? 2,1\r\n???#??#??????.?? 1,1,3,4,1\r\n#?##???#?#.???##? 8,1,4\r\n????.###.????## 1,3,1,1,2\r\n????????.????##?#?? 1,2,1,1,2,6\r\n?.???#?????. 4,1\r\n????#?.??.##?? 1,1,2,3\r\n#??????.??# 3,3,2\r\n..####.#?#.?????##?. 4,1,1,6\r\n??????????#?????? 1,3,2,2,3\r\n?.??#???#?#??????#. 3,10\r\n?#?.#???????#??# 2,4,1,1,1\r\n??????????? 7,1\r\n..??..#?#??#???#??## 2,14\r\n?#?#.????? 1,1,2\r\n#??#??#??#.#?.?.#.?. 7,1,1,1,1,1\r\n??????#?.??.#.????? 1,4,2,1,5\r\n?#????#??? 1,1,3\r\n#?#??#??..??.#???? 8,1,4\r\n??#??#?#?#???#????? 2,1,11\r\n?##??#?#.?????.?? 7,2\r\n#????##?..?. 1,5\r\n????#?#???????#??? 8,1,1,2\r\n???.????.?##????# 1,1,2,4,3\r\n??????##?###?? 1,1,9\r\n???#?.??#?#.?.????# 1,3,1,3,1,1\r\n.#???????##?#?. 10,1\r\n????#???.?????#??? 2,3,2,2\r\n##?.????#?#?? 2,2,5\r\n.?????#???#??#?.#? 1,1,6,2,2\r\n?.??#??.??#?#?#?#?? 1,1,2,11\r\n.?#???#?..? 2,3\r\n.??.??#.?? 2,1\r\n?????#?..?? 1,2,1\r\n.##???#????.#.??? 2,5,1,1\r\n??.??##?????. 2,4,2\r\n..##.??#????????#.?? 2,1,10,1\r\n???###?#??#. 1,8\r\n??..??##??.? 1,4,1\r\n?.?#?#..???#?.#??. 1,3,5,1\r\n??????#?????? 1,1,1,4\r\n??.#???????????#? 1,10,1\r\n???.?????.????????.. 1,5\r\n???####.????? 6,2\r\n#?##?.?????????? 4,2,3\r\n???.?#????.??.?#.? 3,1,3,1,2,1\r\n????????.?.?. 7,1\r\n?.?##?#??.??#?#?#?? 1,6,5,2\r\n.??#???..?#??...??# 2,4,1\r\n#.???????# 1,6\r\n?#.??##.??.????? 1,2,1,2,1\r\n?.?..???#?????? 6,3\r\n?.??#?#?#?? 1,7\r\n???#???#.?#?.???#.# 1,5,1,1,1,1\r\n??.?????#??????.?.? 1,1,4,1,1,1\r\n.?.?????.??# 1,2,1,2\r\n???..#?#?# 1,3,1\r\n?..#?#???????#? 1,4,1,1,1\r\n??#?.???#???#?? 3,4,1,1\r\n????#???????#??????. 1,13,2\r\n?.???#????..?. 1,8,1\r\n??.?#?.?.???##?.?# 1,2,1,6,1\r\n???..???#???###?#??? 2,13\r\n...##??#?.??. 5,1\r\n???.?#?#?? 1,4\r\n?#??????.#? 2,1,1\r\n##?#????#? 4,4\r\n???.#?##????#??????. 1,5,4,1,1\r\n#.??????#. 1,1,1\r\n??????.?..#????#? 4,2,1\r\n??????????##???. 2,1,7\r\n?#?????????? 2,5,1\r\n?.?.????#??? 1,5,1\r\n????.#??##?..?.? 2,6,1\r\n????????#???? 1,1,1,5\r\n.?.????##???#?.??? 1,10,1,1\r\n?.?????#?? 2,2\r\n.????.#??.??#?? 2,2,4\r\n#??.#????#?#????.. 1,12\r\n?##?.??##????? 2,6\r\n?.??.#?#??#####?.# 1,10,1\r\n.??#.?????? 2,4\r\n?????#???.?.##? 1,4,2\r\n??..???..?.??#??. 1,2,3\r\n???##?##?#?#??????.. 1,13\r\n????.?.??.#?#?##???# 1,1,1,10\r\n??#.?????##???????.? 3,11\r\n.?.?..??#??#??? 1,7\r\n??#?#.???.?##??? 1,1,1,1,4\r\n???????#??? 2,4\r\n.?#??##??#?????? 1,5,1,1\r\n?#?#???#?#?.#?#?# 5,3,5\r\n.?..??#?#???#???. 1,10\r\n????#?#?#??.?? 1,4,2,1\r\n?????.#??#??#??? 2,8\r\n??.?#?????????#???.# 1,13,1\r\n?????#????#?? 1,1,5\r\n?????#???.??#?? 5,2,3\r\n?.?.????#.. 1,4\r\n??.???????#????.#?? 2,1,1,1,2,2\r\n???.#???????#. 1,1,5\r\n????#?#.?#??.???.?? 1,5,1,1,1,1\r\n.??.#???.#??#??.?# 1,1,1,4,1,1\r\n????.?????##?? 2,1,4\r\n??..??????.??? 1,3,2,2\r\n????.?????. 4,2\r\n????..??????##??? 4,1,1,4,1\r\n??..??#?##??.#?? 6,3\r\n#?.?##?#?..??#? 1,6,2\r\n?#???????#.# 2,2,2,1\r\n???..?.??. 1,1,1\r\n.???????.? 1,1,1\r\n?#????????##? 1,2,3\r\n??????#???.?.?##?#. 1,7,3,1\r\n#??????#??? 1,6\r\n?..???#??????? 5,1\r\n??.???.??#??# 2,1,3,2\r\n#?.?#?????#?##???.?. 1,2,8\r\n.#??#???.???.? 1,2,3\r\n#????????#??? 5,3,1\r\n??????#???###. 7,5\r\n????##?????###? 1,4,1,4\r\n?????.????#?#??.? 3,1,1,5,1\r\n??#?#??????#?.?. 2,1,1,1,2\r\n#??????#?.?#? 1,4,2,1\r\n?#???#...???? 2,1,3\r\n???.??##???#.??? 3,1\r\n??.?#?.???#?#?##??# 1,3,1,1,1,5\r\n?..????.?? 2,2\r\n???.?????? 1,1,1\r\n??#??????.????. 7,3\r\n??.????????..??.?#?? 1,1,1,2,2,3\r\n??#.???.?? 1,1,1\r\n?????????#????.?##?? 1,1,7,1,3,1\r\n??????#??##?## 2,1,1,6\r\n#?????.?#???.? 6,4\r\n.?#??#.?#????. 2,1,3\r\n??#?.??#?? 3,3\r\n??#??##??#. 4,3,1\r\n???#????.?.?????.?? 1,3,1,2,1,1\r\n?#?.???????#. 2,8\r\n??.#?????????????#?? 3,3,6\r\n?.??###??#. 5,1\r\n????.?#??? 4,3\r\n?.?.????#???#.# 1,1,1,3,1\r\n.##???#.????. 4,1,1,1\r\n??#?##??????#?? 1,6,1,1\r\n?#??##?..??#?. 5,3\r\n#?#????#.#??#? 3,2,1,4\r\n??#???#?.? 1,2\r\n??##?#?.#?#???? 1,4,3,1,1\r\n?#??.???###??. 3,5\r\n??.?.?????#????.? 2,4\r\n#???.??#?#???.???? 3,6\r\n?#?#????#.?#???##??? 4,1,10\r\n??.#????????#??.? 1,1,1,6,1\r\n??#??#.????.??. 3,2,1,2\r\n?#.?#?????.#? 1,3,1,1\r\n????.??.?????.?? 2,2,3,1\r\n?#.????..???.# 2,2,1,1\r\n?.??##??#??????. 3,1,2,2\r\n?????#.?##????#.? 2,1,6,1,1\r\n.?###??????.?#? 8,1\r\n.??..##???#?#?? 2,9\r\n.??#?####???.?.? 8,1,1,1\r\n??.?.?.#.? 2,1,1\r\n??????.??#??? 4,1,3\r\n??.?????????..??? 1,2,1,3,1\r\n?.???#??..??##??..? 1,1,1,1,6,1\r\n###???#???????#...#? 13,1,2\r\n#?###?????#?????##? 1,6,4,1,2\r\n.?...?.#??.??##?.? 1,2\r\n??.?.??#.??.? 3,1\r\n??????.?#?##??.? 3,1,6,1\r\n??????#?#.??#?#.. 2,1,2,1,5\r\n?#??#.?.??###???##?? 2,1,1,4,6\r\n#?...?#?#. 1,4\r\n#??#????#?.??.???. 1,7,2,3\r\n??????????#??.?. 1,8,1\r\n????????#??.?.??#.?? 7,2\r\n??#??#?.??#??#???#? 4,10\r\n#?#.?#????? 3,2,2\r\n??#.?????.???? 2,1,1,2\r\n.?#???.#????#?? 2,6\r\n???.?.##??.???? 1,2,1,1,1\r\n???????###.#..#?. 2,2,3,1,2\r\n??#?#??...?#.. 4,1\r\n??..???????.?. 1,1\r\n????#?#??? 3,3,1\r\n????##???? 2,3,2\r\n??.#??.?????#?#? 1,1,1,3,1\r\n.?.??.???. 1,2\r\n??.??#?????? 2,2,1\r\n.?????#.?##??#?#??# 2,1,2,4,1\r\n???#???#???#.??.#?#? 2,7,1,3\r\n?##.?.?.#??#.?#?? 2,1,1,2,2\r\n????.?##.??. 3,2,2\r\n.?#?#?????????##??. 7,1,5\r\n??????###?#??? 3,8\r\n?????#??#.???.?#?.?. 9,1,3\r\n..??##..###?#??? 3,5,1\r\n.##?.#.???.? 2,1,1\r\n..##??#?.???#???. 5,6\r\n???????????#????# 1,5,2,2,2\r\n??##???#????????#?? 1,6,1,1,1\r\n.#????????#. 3,1,1\r\n?#???????.????# 2,1,1,2,1\r\n??.?#????##? 2,4\r\n#?#?????????##?##.? 1,1,1,1,8,1\r\n??.#???#??.#?. 1,4,1\r\n?.?.????#..?? 1,4\r\n????..#??????##??.?. 1,1,11\r\n?#????.?.? 4,1,1\r\n#?????#????#??.???.? 1,1,7,1,1\r\n.??.#?.#????#.#???? 1,2,6,1,1\r\n??#???#??? 5,1\r\n??????#.?????? 6,1\r\n?#??????#?#.?.. 1,4\r\n.?????.??..???#???? 3,1,6\r\n?#?.??#?#?#??#.??. 1,1,8,1\r\n???.#.??.???#??? 3,1,1,6\r\n??#?#????.?? 6,1\r\n?????##????#?#?#??. 4,8\r\n.?#???????#.?#.??#?? 7,1,1,1,1,1\r\n?##?#??#.??# 5,1,3\r\n?.#?????#???????##?? 1,2,11\r\n??#???#??. 1,3\r\n.?.???#???#.#?..? 1,4,1,2\r\n#??.#??????. 1,2,1,1\r\n.??#?###????#? 1,4,3\r\n??.???.?.????.? 1,2\r\n?.?#??.??#.?? 3,1,1,1\r\n?#.????#????. 1,4,1,1\r\n.?##??.?.?#.?# 5,1,2,1\r\n????#???????.?##?. 10,2\r\n???.?#???.????###?# 1,1,2,1,8\r\n?..?#?.##?? 2,3\r\n???????????.#??#?# 2,1,1,1,4,1\r\n???..???.????#? 1,3\r\n.#???#?#?# 1,5\r\n???.#?.#??#??##.?.? 1,1,8\r\n????????#????.?#???? 7,5,4\r\n???.????#?#?? 1,3,4\r\n?..?#?????.##?? 6,3\r\n?????????.???????? 1,1,4,1,2\r\n????#??#?.??#.? 3,1,3\r\n??#..????? 3,3\r\n??#.??#???.#??. 3,3,1,1\r\n??#?.???#?????? 1,1,7,1\r\n????#??#?.????.??#?? 7,1,1,1,1\r\n.??#???#??#?????#?? 2,11\r\n.?#?#?#??? 3,3\r\n????#???##. 3,2\r\n.?#??#???????? 4,6\r\n.??.???###?. 2,5\r\n??.?.?????#?#??? 1,8\r\n???..???#?#?..?#?? 3,1,1,2,2,1\r\n????.?#???##?##? 1,1,1,1,5\r\n?????????????????# 1,1,3,1,5,1\r\n#??#.?#.?. 1,1,1\r\n????.#??#??.??.? 2,4,1\r\n??#?#.?????. 1,3,4\r\n#?#???#?????#.?? 1,7,1,1\r\n?#??????#?? 2,1,1\r\n?????????.###.???? 1,5,3,1,1\r\n??????##??.?#.?? 1,7,2,1\r\n?.??.??????.???? 1,2,2,3\r\n.??????##???..??##? 8,4\r\n.???.?.#??????#???# 2,1,4,7\r\n?#.#????#???? 1,4,5\r\n?..#??##??#?.?#?#??? 1,1,2,2,4,1\r\n??..??????.?? 1,5\r\n???.????#.??#?#????? 2,1,1,10\r\n???????...?# 2,1,2\r\n#.?#??#?#?#?#?.??? 1,4,1,3,1\r\n.??#??.#?# 4,1,1\r\n??????????.????.? 1,4,1,1,1\r\n?????.????#??? 3,2,2\r\n???#??????#????#??? 11,1,2\r\n.?.#?#?#.?. 1,3\r\n??.????##??..# 1,1,4,1\r\n?????#??##??.?#? 1,10,2\r\n..#??#?????? 4,2\r\n.?#??.???#?? 3,5\r\n.?????.??? 1,1,2\r\n?????????. 1,1,2\r\n???.???.?#?.??? 3,1,2,1\r\n???#??.?#?.#.? 2,1,2,1\r\n.#????#???#????? 3,2,3,3\r\n??????#?#.??? 1,4\r\n?.????#??##. 1,2,5\r\n?.??#?#.?? 3,1\r\n????#?#????.#???#?.? 3,4,1,6\r\n????#?#?#?#?#??#??. 9,8\r\n?..?#..### 1,1,3\r\n.????????#?? 7,1,1\r\n?.?#??#??.?????? 3,1,1,1,1\r\n?#??.#?#???#??? 3,1,1,3\r\n?#?.????#?#???.? 2,6,1\r\n??.???.?????? 1,2,2,1\r\n?#??..??????#?# 2,1,2,2,1\r\n??#?????#???#???#?#? 12,2,1\r\n??#???.?#??? 1,4,2\r\n???...#..?#??? 3,1,3\r\n##?.#?#?##????##??? 2,6,3,1\r\n.#?#?.?.???#?#?## 4,8\r\n##??.??????#. 3,6\r\n?#???..#.#.??##?? 1,1,1,1,5\r\n??#??#?#?.#?.#??#?? 1,7,2,1,1,1\r\n.?.???????##??.?? 1,2,3,2\r\n??#????#????.??. 8,1,1\r\n???#?.?#???? 2,2\r\n???#?#?#????? 7,2\r\n????.????? 3,1\r\n###?#?#????? 3,4,2\r\n??#?#??#.?.#?#?##?. 5,2,7\r\n.??.???#..???#??.? 1,1,1,5,1\r\n?#?..???.? 1,3\r\n..?##?.??..#?#?##?#? 3,1,9\r\n?.??.?##??. 1,3\r\n????#???###??.?# 1,1,4,2\r\n#??#...???? 1,1,3\r\n?????..#?# 4,1,1\r\n??#?#?.??.. 4,1\r\n..?#.??#?? 2,2\r\n???.?????#??#?? 1,6,2,1\r\n???.#?##???#??? 2,11\r\n???#????#?#????#??? 2,9,5\r\n??.???.??????? 1,2\r\n??##?...????#?? 4,4\r\n??#??#????? 5,1\r\n?##.??.?.#.?.? 2,2,1,1\r\n.?#.??#???.#?#?..?? 2,5,3,1\r\n?#???##?????#? 9,2\r\n??#??.#?#?.??# 4,1,1,2\r\n#.?#?????? 1,1,1\r\n????#???????.??.? 11,1\r\n??.?#?#???#??#? 2,10\r\n?#??#??#??#??#??#? 8,1,5\r\n?#?#?#?????????#.??# 1,7,1,1,2\r\n.??.???#?. 2,1,1\r\n??...??#?#. 1,4\r\n.??.#????.?.? 1,2,1,1\r\n??#?#.?#???###?#? 3,7,1\r\n?????#???###?.??? 2,1,6,2\r\n?#?#???#.???#?.?.# 8,1,1,1\r\n?.??#?#?#??###??# 1,14\r\n#.??#????????.. 1,5,1\r\n##?#???????#???##??? 9,4,2\r\n.??..???#?? 1,3\r\n##????.?????. 2,1,3\r\n.???.??????.#???## 1,3,1,1,4\r\n#.?##??#??##? 1,7,2\r\n?#??#????? 2,4\r\n.?#???#??#??#?#. 7,4,1\r\n????#?.#??#.. 1,2,1,1\r\n??.?##.?#??#?? 3,1,3\r\n?.????.??#?#????.??? 3,5,1,3\r\n?????#..?###?.???.?# 2,3,5,1,1,2\r\n#?.?.#?.?#?? 1,1,1,1\r\n?#?.???.##.?.?.? 2,2,1,1\r\n#?#???.?#.?????? 4,1,2\r\n?.??????.??? 1,2\r\n.#????#??#?##?.? 2,1,5,1\r\n???#?#???.#. 1,1,1,1\r\n?##??##??????.???? 7,1,2,1,2\r\n#????##?#?..#?#??. 9,1,1\r\n??#??.??#??#????# 1,2,1,1,4\r\n.????#???#???? 5,1,1\r\n???#?.?..???????# 3,4,2\r\n????#?#??#??.????.. 7,2\r\n#?#????#.???..#? 5,1,2,2\r\n?#?#?#??.??????.. 5,1,2\r\n??#??????? 1,5\r\n..??##??.?#??..??? 3,2,1\r\n#????.??????#? 1,1,4,1\r\n?#.#??????#? 1,1,1,3\r\n??.??.???#???. 1,2,1,4\r\n??#?#?????? 4,3\r\n?????.?.??#? 1,1,1,1\r\n??##??#???#?? 6,1\r\n?.????###??#??? 3,1\r\n??????????#??.#? 3,1,1,2,1\r\n????#?.???##?? 1,1,6\r\n?.?#?.??#?????? 2,2,2\r\n#.??##?#?????#?????? 1,10,2,1,1\r\n?.??#???..???? 1,1,2\r\n.##????.??? 4,1\r\n#???..???#??#???#??? 1,1,1,1,9\r\n#.#??#???????#.#?#?. 1,7,2,1,2\r\n??#??#?????#?###??? 5,3,7\r\n?#?#?.??.??? 1,1,1,1\r\n..#????????# 1,2,3,1\r\n?.??#.?#??? 2,2\r\n.#?????.?##???#?? 6,8\r\n?.???#????..??????? 4,1,3,2\r\n????.???#???..? 1,1,2,1,1\r\n#???#??????????? 1,2,1,6\r\n?.??.???#? 1,4\r\n??#????#.??? 4,1,1\r\n????.??.?#??.??? 1,1\r\n#.?.?#??????.?#?.? 1,2,3,3\r\n?##??##??.?..? 2,4,1\r\n???.??#?????###?#?# 1,13,1\r\n????????.?????????#? 2,1,1,9\r\n?#?#??#?????#????? 2,2,1,1,3,3\r\n??..#??.???.???## 3,2,3\r\n?.?#?#???#? 4,1\r\n.?#??#???#??????#.? 10,4\r\n???????????##???.? 1,1,1,1,3,1\r\n..?#??.#???????#?? 1,1,7,1\r\n?????#?#?????? 1,3,2\r\n.??????????.#?????? 2,4\r\n??.#?#?.?.???? 4,2\r\n???#????.?#???# 1,1,3,3,1\r\n??.??????.???.?? 1,3,2\r\n?#.#?????#???###? 2,1,11\r\n????.#?.#????##???.# 2,1,2,5,1\r\n??.##????##?... 3,4\r\n..?#??.??.?##??#??.? 4,6\r\n?#?????????#?. 6,3,2\r\n??.##????????####??# 1,15,1\r\n???.?.????? 1,3\r\n???#?#.?##?? 5,3\r\n.??#?..##? 4,3\r\n?????#??#????.##? 6,2,2,2\r\n??.#??#???##.#. 1,3,2,1\r\n?#.?.????.?. 1,2,1\r\n??.?????????. 2,3,2,1\r\n????#???.? 1,2,1\r\n??????.#???. 1,1,3\r\n#..?.??#?? 1,3\r\n..#.?????????. 1,4,2\r\n?.??????#?????.? 7,2,1\r\n?#??.?.#?###??? 1,1,1,5\r\n.??.?#.??.?.???...?. 2,1\r\n???#?.#?#?.??..?#.? 1,3,4,2,2,1\r\n..??..?#??. 1,4\r\n.??#?????.??????? 6,3\r\n?..??????..???.? 1,2,3\r\n#?????.?#?????#????. 1,1,1,12\r\n?????????.?#??????? 1,5,7\r\n???.?#.???.??? 2,2,2,3\r\n??.?.?.??#.???? 1,3,2\r\n??.????##????# 1,6,1\r\n?.???????.?#. 1,2,1,1\r\n..??#.????.?????? 3,1\r\n??#?#?.###?#??#?#.?? 4,5,2,1,1\r\n??#?..???? 3,2\r\n?#?##.???.#.??##???# 5,1,1,1,4,2\r\n.#.?#?.??# 1,2,3\r\n#?.##??..#???.???#?? 1,2,1,4,3\r\n??#??????????????? 3,1,1,2,1,1\r\n.??.#?.?#??# 1,1,3,1\r\n?.?#??#???????#????? 1,5,3,4,1\r\n???#????#??? 4,3,1\r\n.??#???.??#? 2,4\r\n##?.??.#??#??? 2,1,6\r\n#??#..##..?#. 1,1,2,1\r\n?#?.#?#??#??##.???#? 2,3,2,2,4\r\n..????????.?.??.?#? 1,1,3,1,1,3\r\n#??.??????# 2,5\r\n?.###???????? 3,1,2\r\n.?#??#?#???..????? 2,7,3\r\n?#?##?#??.##?..?#?? 7,2,3\r\n??#?.??..?#?#.# 1,1,4,1\r\n??#????????#.? 9,1\r\n##?#?##????????????? 8,1,1,2,3\r\n#????#?????#???? 9,1,1\r\n?#..???#?.#???#?##?# 1,1,1,10\r\n?.?????##.?#?? 1,4,2\r\n?.????????? 5,2\r\n?#?#?????.??#?##?? 4,2,8\r\n???.#??#.?#??#?.??? 2,1,1,5,2\r\n?#??.?????????#. 4,2,4\r\n.##?????.#.?. 2,3,1\r\n.##..????.? 2,3\r\n?#?#???.????.???? 4,2\r\n##?.???.????? 2,1,5\r\n?#??.?#??? 1,1,5\r\n?.????#??..#?..? 2,1,2\r\n#??????#.. 1,2,1\r\n???#??..?#??? 1,1,3,1\r\n??#???.#??? 6,1,1\r\n???#?????????????? 3,2,6,2\r\n#??????.?????? 4,1,1,1\r\n?????#?#?? 2,6\r\n?##?#???????.???? 2,2,1,1,4\r\n?..?????#?.? 1,3\r\n##..#?.??. 2,2,2\r\n..#??????? 1,2,1\r\n..?????##.. 2,3\r\n??#???????#? 1,3,2,1\r\n#??.#???????????? 3,3,1,4\r\n#??.??#.???? 2,1,2\r\n?????#?.????? 1,2,1,1\r\n????#?##???##??#? 6,8\r\n?.??#?.?????.. 2,4\r\n??.?????#??#? 1,1,5\r\n??????#.#???.?#??? 2,1,1,4,1,1\r\n?#??.???#???..?# 1,1,2,1,2\r\n##???.???###? 2,1,1,4\r\n##?????????????##?#. 5,1,1,7\r\n??..???#???????????? 1,4,1,1,3,1\r\n?..??#??.?##?? 1,1,1,3\r\n.?.??.???#.?.?? 2,1\r\n??????????? 1,4\r\n????#.???? 3,1\r\n??#??????#??.? 2,8,1\r\n.????#?#??????. 6,3\r\n??#?###?.?.???#????? 8,1,1,4,1\r\n????.?#???. 1,5\r\n?.????#????. 1,7\r\n????.????? 3,1\r\n?.#..##??#????? 1,1,9\r\n#?#?#??????##?????? 1,1,10,1,1\r\n??.???.#?? 2,1\r\n.?#????#.???.?.# 4,2,2,1,1\r\n.????#.??? 1,3,1\r\n???????????#???? 1,6,3,1\r\n???.#?.????. 2,2\r\n??#?????#??? 8,1\r\n???????????. 1,1,2,3\r\n???#.????.#?.??# 3,3,1,1,1\r\n????#??..?.#?. 3,1\r\n.##?????#?????.?.?#? 9,2,1,1\r\n????.???????#?? 2,1,6\r\n..??.?#??? 1,2,1\r\n#?.???#.????##. 1,1,1,1,2\r\n?.???#????# 1,1,6\r\n?.????????? 1,6\r\n???#?##???#????.?.? 9,2,1\r\n?.#?#.?????#???###? 1,1,1,1,1,8\r\n???#.?.??.#? 4,1,2,1\r\n???..?..?# 2,2\r\n?????????? 1,2,1\r\n..???#?????#... 1,7\r\n??.????.#????? 1,3,1,3\r\n.?#???#??? 2,1\r\n?????????.??????? 2,1,3,1,5\r\n???.??????#???? 2,6\r\n??##???#?#? 3,1,2\r\n?...?#?.???... 3,2\r\n???#?..?##?? 2,3\r\n#?#??????#???#??#?? 4,13\r\n?????#????. 1,1,1\r\n.?.#?#????#?????.??? 1,6,1,2\r\n????#??????.?? 8,1\r\n.?#???#???.#?# 2,1,1,3\r\n????#.????? 5,1,1\r\n.?#???.?###?.??# 3,5,1\r\n?#???#??????#??.#. 8,4,1\r\n??????#.#???.?? 1,5,2,1,1\r\n#???##.?##?? 1,3,4\r\n#.?.?.???????? 1,1,4,1\r\n?#????#??#?? 2,3,3\r\n#??#???????.#?? 1,1,1,2,1\r\n.????????? 1,1,1\r\n???#?????..??. 9,1\r\n..?#??#?.??..???. 6,2\r\n?.?#????????.?...?? 4,4,1,2\r\n#?.????.??# 1,4,2\r\n.?#?.??.#?????? 1,1,1,4\r\n..#?????.??#???.## 2,1,1,1,1,2\r\n.#???????.?#??. 6,1,3\r\n.#??#?.#?????#??.??? 1,1,1,7,1\r\n?#???.?.?#??? 1,2,1,4\r\n#?.???????????????? 1,2,6,1\r\n???#.??..?? 4,1\r\n#???.#????.? 2,1,2,1\r\n.#??????.#??.? 2,2,2\r\n?.?????#??#.??#?.? 2,4,4\r\n.#???????##. 1,1,2\r\n?#??????.#.##? 2,4,1,3\r\n?#????.???#? 5,3\r\n?.??#?#??##.#? 1,4,2,1\r\n???#?#?##??????? 1,6,1,1,1\r\n?..#?.#?#? 1,1,2\r\n????.??.#?? 1,2,1\r\n?#?.?.#?...?? 2,1,2,2\r\n?????????#???. 1,1,1,5\r\n.?#????.???#?? 6,1,2\r\n??.?#????.???#. 1,4,1,1\r\n.???#??.?????### 4,8\r\n??##?????#??? 8,3\r\n?#???????##.? 3,4\r\n??.#???#??#?. 5,1\r\n?#.????#????#.???. 1,1,6,2\r\n???????#???#?? 3,6\r\n??#.?#.???? 2,1,2\r\n????????.?#??????.?? 1,1,1,1,6,1\r\n.?.??????????#?? 5,4\r\n?#?..???#??#??#??? 2,11\r\n??#???.???#??#??? 2,2,6\r\n##?#??##??#?????..?. 9,2,1,1,1\r\n#??????.?.#??#? 1,2,1,1,1\r\n.???.??#?.#?? 1,1,2,1\r\n.???#.?#??#?#??# 4,1,4,2\r\n?.?#???????????.? 2,2\r\n?.????#??????.?? 4,1\r\n?#????????#?.?.# 6,2,1,1,1\r\n..????#?????#. 5,1,1\r\n????#.#???????????? 1,1,1,1,8,1\r\n?...?#?#??? 1,3\r\n?#?????#..?.?? 7,1\r\n??#??????.#?#?#?.?? 4,2,6,1\r\n???#???.??. 4,1,1\r\n???#???#?#?#?#??#??? 2,1,3,9\r\n??.????.???##?# 2,6\r\n???.#????#?#??#??.# 1,1,1,10,1\r\n??????????.??#?#?? 2,5,4\r\n??#????????#?# 1,5,3\r\n????.?..#??? 2,3\r\n.?#??#??.???..?# 1,2,1,2,1\r\n#????????????###?#?? 3,14\r\n???????..?????##?? 2,2,9\r\n?##?#?.???.????.??# 5,1,1,2,1\r\n???#.????###?###.??. 1,1,1,8,1\r\n?#??????#??#? 2,1,6\r\n?..?..??#. 1,1,1\r\n#???????????.?? 1,6,1\r\n.???.?????? 1,3,1\r\n?.????#????##??.? 1,8,1\r\n??#?.?.???.?..? 2,1\r\n?????#????????? 1,1,1,2,1\r\n???????????.?.?# 1,5,1,1,1\r\n??#??.??#??#?????? 3,1,4,2\r\n.????##???# 4,1\r\n???#.?#??.???????# 2,3,5,1\r\n?????#.#?.?.#???. 6,2,4\r\n?.??#????.#??#???# 4,8\r\n#???.?#.#??#.??##?? 1,1,1,4,2,1\r\n?#?.##..#?##.?# 2,2,4,2\r\n???.??????.??????#?# 1,1,1,1,1,9\r\n?.?#??#?#.#? 1,1,3,2\r\n?#????.?#???? 4,3\r\n??#?#?#?.????? 7,1,1\r\n##?#??#??.? 8,1\r\n??#.?###?#?.? 2,6\r\n#?##????????#. 7,1,1,1\r\n??..#???##???.?#???? 1,3,2,2,5\r\n??#?#?.????#?# 3,1,2,4\r\n??????##??.#???? 3,3,3\r\n?#???#.?????#?? 4,1,5\r\n??.??#???????.?#. 1,6,1,2\r\n..??????????#?## 8,1,2\r\n.#???.##??.?#??#?? 3,2,1,1,2\r\n?#???##?.. 1,1,2\r\n.????#?.?##??#..??? 6,6,1\r\n??#???##.?.###??#? 7,4,1\r\n?????????#?#???? 9,1\r\n?#?##?#???#?.. 7,2\r\n.#?.?.????? 1,1,2\r\n?#.?#????#.?? 1,3,1,2\r\n.????#??.??#..??? 4,3,2\r\n???????.?#??###??. 6,7\r\n.???##???#?? 1,4,1\r\n????#?###???#? 1,1,1,7\r\n#?.?.?.?#? 1,1,1\r\n?.##?#?.?#??.#. 4,2,1\r\n??.???.??#?##?.???# 2,2,6,1,1\r\n.???.#..#???.?? 2,1,1,1,1\r\n?#????.?.?# 2,1,2\r\n??#????#?#?.??. 3,1,1,2,2\r\n???.????#.????? 1,4,2\r\n.??##????#?.???. 5,4,1\r\n?##??#????#??# 2,2,1,4\r\n?#????.#?#???#?? 2,2,7,1\r\n????#..?#? 4,3\r\n#.?.#?????#? 1,1,2,3\r\n??#??????#?.??? 5,1,1,1,1\r\n??????#.#? 1,2,2\r\n??#.??????#? 3,4,2\r\n#?????#??.?.##????? 1,1,4,1,5,1\r\n??.??.???#???##????. 1,6,4\r\n.?#?.?..?#? 2,3\r\n?#??????.?#?.# 5,1,2,1\r\n??#????#??.#?#? 7,3\r\n??#??#?.????#? 1,2,5\r\n???.???..??????? 2,3,3\r\n???#???#??? 1,7\r\n#???.???#??? 1,2,1,3\r\n?????.?.#??.??# 2,2,1,2,2\r\n??.?#?????????#??##? 1,16\r\n??.???????????? 2,6,3\r\n?????#?????##?..??# 1,1,2,7,1,1\r\n.#?.??????##??.?.?? 1,2,5,1,1,1\r\n?#???.????.? 1,1,4,1\r\n????????#?#????? 1,1,11\r\n????###.?#??.#? 1,3,2,1\r\n#??.???#??????? 3,4,3\r\n?#?????..? 2,1,1\r\n????##????#???????## 3,3,8,2\r\n?????.??###????? 2,4,1\r\n.?#??#???.?? 2,1,1,1\r\n????#??.?????. 5,1,1\r\n?#?????.??.????# 5,1,1,1,3\r\n?##.??????# 3,5\r\n??##???#????.?#.?? 7,3,1,1\r\n?..#.??##???.?? 1,7,1\r\n?#?##?????#??.?# 1,10,1\r\n??.?#?#.????#??. 4,1\r\n.?????#?##.??. 1,7\r\n???#.???.?#????? 1,5\r\n#?.???????.??? 1,1,5,1\r\n?##??#???## 7,2\r\n#?##??????.. 7,1\r\n#...????????##?##?? 1,3,7\r\n???#?????#?????#? 3,8\r\n?#???#??#.????.??# 1,1,4,1,1,1\r\n??#??#?????????? 4,1,1,1\r\n?.?????##????##????? 1,1,8,2,1,1\r\n?????#???? 5,1\r\n?.??.###?##??#? 1,1,3,2,2\r\n????.??..?? 4,1,2\r\n??.????#.?# 5,2\r\n#.#??.?????? 1,1,1,2\r\n..#??#??.??????#??? 6,6\r\n.#?.??##???.#?#. 2,3,1,3\r\n?????.??.?????????.? 3,7\r\n.##?#????# 4,1\r\n?#???#??#??.#.?# 2,1,3,1,1\r\n??????#???. 1,1,4\r\n.#??###?????#?? 1,11\r\n.????#?????#?##.??.. 10,2,1\r\n??.##?.???#????.# 1,2,8,1\r\n.??#?????????.? 1,1,4,1,1\r\n?#?##?.???? 4,1\r\n.??????#?.?#? 5,2\r\n?.???###.????.?.? 1,6,3,1,1\r\n##??##????????##?#? 7,1,6,1\r\n??#??????????###?? 2,1,1,6\r\n?.??.#.??#????. 1,1,1,1,2\r\n????????.??#? 8,1,1\r\n?.??????.##??#.#?.# 1,1,2,5,1,1\r\n..?#?#???.??.??.?? 6,1\r\n.????#.##?#?##.#??? 1,1,1,7,1,2\r\n??#???#??#?#??? 12,1\r\n#???????????#?#????? 1,2,1,1,6,1\r\n???#..?????#??. 1,1,7\r\n??##???###??.?#?#?.? 12,4,1\r\n??????#.?##.?#???#? 1,2,2,3,1\r\n??.??.?##???????#. 2,1,11\r\n.??#????##??? 3,4\r\n.??#???#????#??.? 14,1\r\n?#????..#??????.. 2,1,7";

            var lines = input.Replace("\r\n", "\n").Split('\n');

            long sum = 0;
            int i = 1;
            foreach (var line in lines)
            {
                var row = line.Split(' ');

                var seq = string.Join("?", new[] { row[0], row[0], row[0], row[0], row[0] });
                var numList = string.Join(",", new[] { row[1], row[1], row[1], row[1], row[1] });
                var numbers = numList.Split(',').Select(x => int.Parse(x)).ToList();

                alreadyVisited.Clear();
                long possible = Solve(seq, numbers);
                Console.WriteLine($"{i++}: {possible}");
                sum += possible;
            }

            Console.WriteLine(sum);
        }

        private static Dictionary<(string, int), long> alreadyVisited = new Dictionary<(string, int), long>();

        private static long Solve(string seq, List<int> numbers)
        {
            if (alreadyVisited.ContainsKey((seq, numbers.Count)))
                return alreadyVisited[(seq, numbers.Count)];
            
            if (seq.Length < numbers.Sum() + numbers.Count - 1)
                return 0;

            if (string.IsNullOrEmpty(seq))
                return numbers.Count == 0 ? 1 : 0;

            if (seq[0] == '.')
            {
                return Solve(seq.Substring(1), numbers);
            }
            else
            {
                long sum = 0;
                if (seq[0] == '?') // branch as '.'
                    sum += Solve(seq.Substring(1), numbers);

                // then check '#'

                // only '.'s left
                if (numbers.Count == 0)
                    return sum;

                int current = numbers[0];
                // no more char left to match
                if (seq.Length < current)
                    return sum;

                // check match sequence
                for (int i = 0; i < current; i++)
                    if (seq[i] == '.')
                        return sum;

                // next char not closing char
                if (seq.Length > current && seq[current] == '#')
                    return sum;

                // was last one but still need a match
                if (seq.Length == current && numbers.Count > 1)
                    return sum;


                var nextNumbers = new List<int>(numbers);
                nextNumbers.RemoveAt(0);
                // ending with last match
                if (nextNumbers.Count == 0 && seq.Length == current)
                    return sum + 1;

                // still left
                var res = Solve(seq.Substring(current + 1), nextNumbers);
                alreadyVisited.Add((seq.Substring(current + 1), nextNumbers.Count), res);
                return sum + res;
            }
        }
    }
}
