using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Day24
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var sinput = "19, 13, 30 @ -2,  1, -2\r\n18, 19, 22 @ -1, -1, -2\r\n20, 25, 34 @ -2, -2, -4\r\n12, 31, 28 @ -1, -2, -1\r\n20, 19, 15 @  1, -5, -3";
            var input = "386183914429810, 203234597957945, 537104238090859 @ 6, 106, -164\r\n191853805235172, 96933297552275, 142797538377781 @ 205, 517, 229\r\n447902097938436, 262258252263185, 255543483328939 @ -136, 38, 89\r\n348809145017052, 223928559740138, 293883056800888 @ -112, 99, -70\r\n259305373591262, 323676876120897, 279139888221037 @ 133, -22, 94\r\n331296830875471, 299479348395869, 225858293640676 @ 69, 10, 160\r\n280761666456810, 405119910828575, 63496246448680 @ 6, -304, 412\r\n517557775415046, 258029729778873, 521504517642081 @ -157, 48, -181\r\n272083044427813, 222499798799301, 288621620613914 @ 63, 98, -22\r\n233786142886000, 241468118092245, 219319444178305 @ 21, 56, -113\r\n201895615785768, 230834417749273, 374012189931689 @ 167, 98, -645\r\n225438217322018, 15337614530169, 434473341703033 @ 114, 675, -560\r\n309203622769858, 266191680021297, 459191860708593 @ 88, 42, -76\r\n372868059967440, 356862574197139, 375054481576155 @ -31, -85, -64\r\n297921162499986, 234644220204383, 344634603844375 @ -58, 79, -268\r\n363633412312501, 326480838944207, 358495660133969 @ 7, -32, -9\r\n210841289893910, 232280136023789, 167060070371365 @ 148, 88, 157\r\n246119440981683, 305960223328391, 127911301891576 @ -73, -276, 294\r\n323307803653692, 383087675556191, 341502094289045 @ -97, -263, -223\r\n375815330355055, 354793141717139, 387413058821165 @ -221, -200, -333\r\n331766662956063, 213479055977873, 339314829600958 @ 25, 102, -14\r\n363863161956490, 262039973241169, 226982776834430 @ -26, 38, 126\r\n203462312495783, 246574518197688, 153900561143472 @ 15, -63, -22\r\n368809468722300, 315543279175559, 352559575391479 @ 11, -15, 10\r\n226305914189598, 207627684171425, 247009277277283 @ 88, 174, -126\r\n217953380151369, 162614125152554, 347919294441031 @ 103, 365, -575\r\n372745306340370, 506476347881289, 324624498353745 @ -196, -525, -169\r\n390869504651475, 283142180285469, 251872936335860 @ -25, 18, 114\r\n252445971986433, 248594382660659, 234146525308183 @ 29, 40, -35\r\n433927391440949, 297255516804081, 316824746537200 @ -57, 6, 52\r\n446104016725566, 202914487226334, 334091997141700 @ -46, 105, 52\r\n419349507564770, 263507579026369, 227821604645985 @ -128, 33, 114\r\n383433654119394, 361545920113961, 290137109614513 @ -110, -133, -5\r\n196882859200254, 222752477299529, 180385336163389 @ 113, 340, -506\r\n292691399854368, 143417381719727, 115055264642479 @ -83, 341, 310\r\n309908324195682, 239167679903785, 251441435411605 @ -58, 68, -8\r\n386466942448336, 422114232708423, 242423357693989 @ -5, -129, 133\r\n296693505518886, 218048645200559, 220691542510869 @ 50, 100, 123\r\n328010214412501, 178770767062295, 337801091114940 @ -83, 196, -178\r\n196205158165026, 202972626769943, 173668521970657 @ 158, 433, -129\r\n372387570879932, 363538563015768, 507101874045999 @ -12, -81, -199\r\n254303143888597, 253145999954568, 171572710653170 @ 33, 29, 152\r\n194954561517714, 231935341275342, 148638289029991 @ 158, 159, 85\r\n260378386938540, 207784303930040, 301340506259458 @ 136, 101, 80\r\n452222471364690, 406572734966321, 243209400511633 @ -79, -114, 131\r\n188213481456850, 243874469237473, 182504238367793 @ 241, 11, -231\r\n198637113515466, 263457253016021, 110567483400589 @ 122, -228, 561\r\n248858814705408, 253140867096173, 190350050811469 @ -33, 8, 25\r\n364374018558030, 362137022274320, 416524944593614 @ 26, -59, -44\r\n194647412318094, 214827834512825, 181241309437711 @ 180, 266, -122\r\n457303394497104, 556093927738121, 132539667655695 @ -85, -278, 252\r\n458228707400609, 260433626867459, 420049826580362 @ -155, 40, -136\r\n296303053004956, 107190003246785, 143064314045497 @ -5, 334, 235\r\n342572713749493, 335041924370232, 291758797285144 @ 39, -37, 76\r\n533318490298149, 419013900657347, 364733512818220 @ -297, -196, -88\r\n239865799177616, 145847686798333, 97596916444209 @ 69, 332, 359\r\n221529694261530, 304920000102289, 29967713187863 @ 26, -330, 890\r\n226680719143797, 183814948822965, 228604806088878 @ 95, 242, -42\r\n364321252714161, 310034104867199, 321482241586483 @ -107, -60, -87\r\n442125665169918, 421921079436875, 183447715971211 @ -86, -144, 193\r\n278470847125827, 164098540239680, 195593280718485 @ -121, 349, 27\r\n326331306804993, 312068596500635, 334401886678639 @ 27, -28, -15\r\n404188890610643, 339056028617190, 337620941723045 @ -197, -121, -133\r\n260807571252021, 96432447501476, 105534068518894 @ 59, 371, 314\r\n240417115856514, 321559031235857, 244833940244785 @ 54, -189, -88\r\n293707293718227, 258842008618679, 270132384849067 @ 57, 40, 53\r\n233986640765697, 241573882332656, 232769315359687 @ -141, 43, -535\r\n199118253974560, 297399926557979, 319799521611620 @ 196, -8, 6\r\n250337867814750, 286418966296679, 229780403621890 @ -70, -156, -188\r\n185666153509650, 216872721774577, 178728218621217 @ 251, 234, -72\r\n283197200887023, 292922423073016, 190036274180788 @ -7, -57, 124\r\n212098227121410, 234308730544039, 87739200391415 @ 14, 107, 708\r\n492115152781338, 494532551989443, 481999548358767 @ -106, -196, -111\r\n196042506716540, 294582095315814, 326311598423125 @ 196, -55, -173\r\n177398171406588, 248482751501216, 165908657558095 @ 260, 31, 137\r\n396566190789769, 301118887900590, 373043497860854 @ 7, 9, 18\r\n231615834414869, 299649465981536, 213899324182427 @ 63, -149, -27\r\n424661470385650, 328479728830041, 394555914391937 @ -24, -19, -7\r\n162243731713440, 219333473061169, 160482016003835 @ 305, 134, 168\r\n352328810159057, 367704509362287, 289223902463341 @ -35, -124, 19\r\n163299381965450, 127335021871989, 271237690551275 @ 234, 180, 114\r\n220094307606378, 224697688677261, 159845679631621 @ -118, 224, -11\r\n324622377269262, 381672344048821, 317647435989765 @ 77, -69, 72\r\n533962461157728, 246112722497423, 287842727709863 @ -187, 61, 74\r\n452447456203760, 411880142915439, 357341774588365 @ -57, -105, 25\r\n288735931917590, 379650304109169, 156040827329965 @ 52, -154, 217\r\n350929103239650, 317630407921649, 260853069259345 @ -31, -48, 63\r\n426434626954874, 312149831439743, 400418064588519 @ -42, -8, -31\r\n237346845989262, 86377161738485, 318534760156942 @ 130, 322, -54\r\n284450782250110, 449437224349189, 542545371131665 @ -14, -430, -713\r\n293182401508130, 275117167691995, 359454063426815 @ 46, 12, -103\r\n195235886859378, 258842576773736, 139725700190459 @ 158, -197, 213\r\n323199639823902, 239204705331901, 281840941464725 @ -76, 68, -63\r\n414541975676790, 460420871271489, 462641193182245 @ -55, -190, -134\r\n383209668002770, 323534301466689, 283759085323265 @ -75, -55, 32\r\n193283930578034, 240453828245469, 199536919861973 @ 198, 60, -39\r\n215999655394946, 213140006407036, 158510376525809 @ -50, 333, 23\r\n424056040026006, 340637534899769, 518787280458349 @ -112, -70, -275\r\n343662884240610, 381839156208074, 300640755882085 @ 46, -81, 75\r\n393165893056098, 458568496623137, 553431148391593 @ -10, -166, -199\r\n295703420241889, 265766474951053, 194212217473621 @ 9, 18, 139\r\n186334163164016, 268988075341331, 192497659792285 @ 237, -113, -83\r\n269030402221410, 220835054670149, 320182802985535 @ 126, 88, 58\r\n285725335312354, 304468906277577, 310820237018457 @ -6, -79, -144\r\n233856184355382, 362160081091865, 318646625168113 @ 137, -132, -49\r\n271324304145410, 356754167468993, 411971238732513 @ 6, -227, -442\r\n369204377510025, 263904445289124, 390789479187170 @ 5, 41, -40\r\n378166976607935, 223914827254464, 455473826802090 @ -15, 87, -130\r\n189399837320340, 52996982745289, 27366904621805 @ 212, 590, 555\r\n355846155064810, 440370438025823, 190506365963750 @ 6, -176, 182\r\n224782728463650, 173997043474385, 322724647666105 @ 146, 186, -88\r\n317135269438233, 296647307318018, 188996201314713 @ -7, -29, 159\r\n206178730489506, 218655589676345, 180184760681209 @ 50, 279, -212\r\n476530263795660, 369469594563689, 513208922412265 @ -185, -110, -269\r\n199271921013378, 162585210128945, 112798266893137 @ 164, 481, 379\r\n199679026815892, 215050704430934, 128620673477157 @ 64, 475, 395\r\n363031677454246, 316143236575138, 224603061330965 @ 10, -19, 147\r\n328706545597884, 327728931187259, 339877554612157 @ -47, -95, -127\r\n327123240768507, 289057301013992, 245201847702409 @ -85, -39, 15\r\n379242403006722, 249124610392305, 299272812776657 @ -88, 53, -7\r\n185410639979586, 63887835066929, 220998498848209 @ 219, 440, 69\r\n228350882847090, 184037098024964, 319857676333405 @ 94, 235, -309\r\n248683502806502, 409020094850641, 272053008957569 @ 123, -178, 51\r\n278853064787260, 153490445678614, 332016709944765 @ -104, 371, -445\r\n231793183338946, 195839385677297, 184433584090033 @ 58, 226, 73\r\n194886280274484, 223387969361249, 159058460041639 @ 188, 150, 129\r\n329845850708422, 327968742735429, 222753031778049 @ -33, -85, 99\r\n374252668017406, 341484016238073, 346321801104265 @ -56, -78, -53\r\n318533855926741, 352787774835221, 238409450890951 @ 33, -86, 109\r\n187423101856268, 252858746670047, 195831394827819 @ 217, 31, 90\r\n247511784432570, 277814873638209, 259358134631705 @ 5, -72, -192\r\n396377180544810, 268686504149429, 403397526958405 @ -124, 21, -182\r\n316236571134754, 287381822883369, 114045323898337 @ -86, -45, 301\r\n415285625415205, 19726362474359, 445149864331673 @ -9, 280, -49\r\n198259591251690, 324792386539613, 181759226872525 @ 136, -831, -218\r\n216667098508285, 162660092727189, 331248039329140 @ 93, 410, -626\r\n234829815303562, 24129148962030, 296359546056467 @ 150, 347, 41\r\n326920166123878, 218474426783430, 59197262645007 @ -6, 101, 369\r\n259585449108287, 271166094257003, 242241608283947 @ -5, -32, -79\r\n213013506235340, 244018001941059, 184141319522630 @ 64, 32, -64\r\n325593716021710, 109577073828497, 278056506205361 @ 31, 238, 63\r\n135049032635241, 137791243726976, 203092751025781 @ 319, 271, 115\r\n303815341519827, 251963337933374, 374441124509405 @ 83, 55, -13\r\n289616250217305, 351370621100849, 406601442712090 @ 95, -58, -58\r\n196174360411005, 237479292407324, 147623588737000 @ 165, 77, 154\r\n199734803814108, 271319920975973, 277239007420207 @ 143, -184, -830\r\n232065632449360, 264418040993689, 209795052740525 @ 51, -30, -31\r\n221062477964215, 241682171398884, 160984765122230 @ -45, 41, 44\r\n312044998486742, 275142594618607, 391610492292299 @ 72, 29, -36\r\n347943512604236, 236299429168808, 328341874011322 @ -32, 73, -44\r\n405313695762798, 331513691312171, 469899352572691 @ -76, -53, -192\r\n264274789429763, 214123367670771, 267561834405422 @ -41, 152, -196\r\n392234648632067, 352180060054370, 288984927283773 @ -53, -77, 51\r\n320756527553408, 193940355797151, 270097818905479 @ 69, 117, 106\r\n282254652887010, 168144273482939, 150833010416365 @ -98, 305, 201\r\n301012916200905, 193738605638969, 278125123789645 @ -89, 190, -133\r\n352194038669679, 348780264907496, 435202693639378 @ 33, -49, -74\r\n407288622579291, 351717471998433, 466303638828890 @ -7, -42, -78\r\n252735489230466, 289269161739569, 225078036140833 @ 110, -10, 109\r\n430170070507020, 205202014855579, 382888583015115 @ -61, 107, -28\r\n395241250689174, 271743360716669, 328377110692465 @ -7, 35, 47\r\n218298194652975, 276424631731649, 239909114023285 @ 105, -74, -141\r\n510500849719535, 406962734754839, 345547110532740 @ -123, -104, 32\r\n366901889107890, 385267457105309, 329417333251225 @ -270, -329, -275\r\n311100604805735, 362616442889283, 282631330659736 @ 31, -112, 34\r\n236389164774610, 257781356831975, 188685373789805 @ 6, -17, 17\r\n244930747958179, 246408919108830, 220272347521184 @ -63, 29, -172\r\n118932109948460, 46482809087689, 2169446318390 @ 312, 350, 444\r\n268288944156670, 436179720022798, 210568077768911 @ 66, -291, 113\r\n222513892414185, 264005071370219, 190639453804270 @ 11, -92, -90\r\n452579530531585, 233345612910414, 428684985834345 @ -59, 75, -49\r\n212686317641585, 271763237625514, 220384255105565 @ -51, -337, -765\r\n444319928195580, 158120442121679, 339537455712980 @ -40, 148, 50\r\n375798322099095, 251247038324864, 257351341054620 @ -7, 55, 108\r\n276642077479880, 405861260851633, 260834887407976 @ 76, -186, 58\r\n292303183047606, 262948214395937, 336580788592453 @ 108, 46, 53\r\n314721983626655, 289928893696024, 268237838682100 @ 51, 5, 82\r\n202197917242394, 242986066373955, 165191889832319 @ 102, 24, -27\r\n267050200593439, 256198380793352, 432637365491249 @ 67, 37, -297\r\n206237001343938, 227322950643852, 136493615519993 @ 14, 213, 255\r\n218312791377510, 155449407797939, 262813280312365 @ 88, 435, -307\r\n213580651698025, 291364628370064, 206384209558055 @ -95, -655, -699\r\n438217357419300, 78161815391897, 142691291752381 @ -59, 242, 241\r\n326117390868849, 300780664680494, 276098318928502 @ 23, -15, 58\r\n451298353033388, 408075617757761, 202804331482875 @ -51, -98, 182\r\n335845081924880, 310872826068959, 173855196832335 @ 45, -11, 206\r\n330506686986682, 270139779739501, 268761001580449 @ -60, 9, -5\r\n238407475974762, 266913625734093, 386427718714268 @ 134, 26, -136\r\n196524352002298, 330525591447517, 296058374699170 @ 198, -78, -8\r\n356873204947732, 339990424132035, 492958645205437 @ -293, -237, -827\r\n412000739902185, 249510228728694, 413765699410065 @ -49, 57, -73\r\n274487717279845, 320772656779033, 317802802218738 @ 21, -114, -156\r\n420553978789548, 99759316072721, 399176363506759 @ -85, 246, -86\r\n222135075092421, 253360091159741, 161975259573747 @ -13, -38, 69\r\n219909713406318, 250284343701405, 174424347332153 @ -16, -24, -45\r\n269073447965821, 189073067688814, 14701803360072 @ 9, 195, 558\r\n222471604132740, 304533906226209, 184521304913320 @ -160, -714, -314\r\n407195612723910, 269079217677389, 315965303517040 @ -46, 34, 38\r\n275822894547454, 369189462657018, 249025889219389 @ -38, -309, -77\r\n309812463311838, 362893866900375, 408403202769849 @ -148, -303, -565\r\n219030713124091, 246145839983672, 167776783882483 @ 7, 13, 25\r\n373059861262948, 259924601227108, 504757748859511 @ -188, 23, -551\r\n466800775825350, 450754776575969, 501226132591813 @ -79, -150, -130\r\n217092276632580, 253956924409734, 178035103062095 @ -40, -81, -147\r\n193606363928098, 241438705946230, 157405702022291 @ 174, 21, -67\r\n204880974350580, 148973056699259, 164134948843635 @ 128, 592, 89\r\n357501632544732, 239295401349070, 502841613106882 @ 44, 69, -110\r\n193601527042002, 103084605510713, 99955649113009 @ 204, 201, 283\r\n241590417576456, 150804921210647, 304454353609639 @ 8, 416, -415\r\n314557123713794, 323849721700017, 253248733039953 @ 45, -42, 95\r\n282006190150275, 339238331044965, 300843044495994 @ -199, -382, -486\r\n302316662163428, 317309916141976, 284604036611062 @ 28, -57, 10\r\n280643118735493, 297445244348253, 198344622453251 @ -53, -102, 69\r\n373354067821536, 345100939062241, 382609663706547 @ 29, -34, 8\r\n369619652225043, 334304701585178, 316120495266961 @ 15, -33, 55\r\n221141067997916, 257683033302529, 324918169173367 @ 145, 30, -140\r\n239770763459346, 216387373390981, 280912332930089 @ 98, 119, -75\r\n414636783115166, 140140846283267, 286398015432413 @ -60, 187, 69\r\n385164578537773, 268707277746528, 493923674114552 @ -93, 23, -304\r\n294425056128360, 485200794023129, 372375375120112 @ 56, -290, -96\r\n348786166767690, 197171878443284, 507593211346255 @ -58, 139, -375\r\n281490003511184, 381837329145523, 214548544846485 @ 55, -171, 117\r\n209463544754634, 254093820996737, 167850564008857 @ 27, -88, -60\r\n272409250657836, 338699762356669, 283520753070099 @ 53, -120, -30\r\n166621688944179, 1429670200655, 226971391506424 @ 295, 916, -74\r\n444686281243810, 470388787297521, 183841228637905 @ -119, -228, 187\r\n227304038479984, 331014103434796, 252307249023258 @ 120, -153, -30\r\n341971756492176, 435997245581000, 297449068595509 @ -128, -369, -109\r\n516682910283664, 500484880987539, 554741397694837 @ -135, -205, -191\r\n259041961806554, 255960324532943, 158048704040591 @ -126, -17, 144\r\n348463742041032, 284190791546899, 511652421870317 @ -187, -45, -691\r\n373854558545475, 180828606995474, 198544402941208 @ -159, 185, 124\r\n197580941904216, 236975933187002, 176387723600704 @ 192, 73, 156\r\n387055419699864, 226421368094213, 344473460050195 @ 8, 82, 37\r\n406176518836578, 249687895138049, 353267256923281 @ -76, 55, -37\r\n217306625337560, 227963327425269, 47429929365511 @ 156, 90, 421\r\n438817742307338, 222876060274225, 394970193033137 @ -51, 86, -21\r\n361770381288396, 308566055048127, 381021697356433 @ 5, -13, -41\r\n216657052841848, 194882809871787, 208072897208729 @ 63, 317, -157\r\n232089099608833, 234616077139838, 140934985675947 @ -27, 91, 225\r\n245931796931772, 256084231881921, 256391579640115 @ 35, 14, -128\r\n254192871383682, 306555373132562, 86198693105569 @ -50, -209, 455\r\n437100035580422, 287047029601627, 248113760190517 @ -86, 12, 115\r\n296284209295372, 285348053731009, 265391246460387 @ 28, -10, 29\r\n317916518458270, 276620392863361, 164560817601187 @ -84, -18, 184\r\n317793656164120, 104420541170219, 427589917123885 @ -60, 352, -365\r\n195279025867846, 253566705538695, 160709999383198 @ 138, -208, -182\r\n323174844425495, 474910623202199, 409600279764725 @ -51, -392, -285\r\n213679700172040, 113591666429359, 215866531965965 @ 57, 909, -283\r\n366541062850050, 254850206230577, 333294167257873 @ 16, 52, 34\r\n299971315236354, 331065157484993, 422787188393329 @ 102, -19, -27\r\n194593564934310, 219256124161489, 222163400502715 @ 170, 294, -755\r\n206256374402739, 239377605836819, 136552753136800 @ 73, 60, 252\r\n366630092655948, 399128250199567, 293692859841525 @ -40, -156, 27\r\n228849424498200, 371467843416479, 199222959448645 @ 27, -569, -51\r\n240064869124290, 12484396251289, 25223806573025 @ 62, 740, 579\r\n551595246951027, 384571722266438, 270266090640409 @ -205, -97, 95\r\n410817527256034, 299943407795852, 143958587306772 @ -18, 7, 240\r\n420695626589915, 557724042660070, 224664972559569 @ -129, -397, 119\r\n196864974163278, 228627735234533, 164349807016033 @ 127, 213, -157\r\n179239857752953, 219723496959685, 215932689339132 @ 267, 162, -144\r\n294244086677130, 410455313332949, 281499307955869 @ 36, -215, 8\r\n330865502614370, 195974965806669, 230157215844909 @ -74, 155, 60\r\n327501872994905, 354937038494586, 417806496377745 @ 51, -63, -73\r\n220677608132279, 219530340855516, 165162813310124 @ -63, 243, -12\r\n199508160008290, 260937173277454, 225778418142605 @ 174, -21, -109\r\n211675660501815, 269791353241949, 182635587216685 @ 183, 34, 195\r\n302755614869610, 348006026624481, 213105057500775 @ -94, -226, 42\r\n304542995872071, 9362593767668, 462600225099186 @ 89, 307, -90\r\n204905076116520, 214681292465789, 120750606529441 @ 36, 370, 455\r\n307070817798451, 95047951758539, 186756723190757 @ 85, 220, 195\r\n200293641494178, 151440322731273, 339954068188257 @ 194, 189, -31\r\n290787289147497, 506733169073744, 500479218844495 @ 23, -425, -423\r\n253190006195106, 152856679937306, 405550882507783 @ 110, 203, -171\r\n506326370214621, 386248552699754, 534403580474488 @ -145, -95, -196\r\n296593231327580, 243180073109239, 308926025446115 @ -8, 60, -103\r\n339186622697190, 171724899854129, 416807381776375 @ 64, 134, -22\r\n405903747916470, 252395832415979, 270877204795435 @ -52, 53, 86\r\n327027526481886, 266764518913517, 257476956763669 @ -27, 21, 40\r\n278536412820174, 176489176170645, 217800628359249 @ 68, 168, 119\r\n356072314841627, 413142891992350, 424826457519923 @ 15, -133, -87\r\n403629392790088, 306631092312491, 266815111954797 @ -36, -8, 99\r\n360704884562151, 260098967051933, 192455750071948 @ -11, 42, 176\r\n278600352075618, 286849416575521, 174644009831417 @ -70, -84, 128\r\n197145491605410, 247991253870449, 181719874558225 @ 161, -8, -111\r\n357630143280750, 342981439901699, 178990293128869 @ -24, -75, 189\r\n418140704240130, 178878993033089, 254976245994625 @ -42, 135, 118\r\n191537613659010, 296901933284619, 238973360227235 @ 206, -109, -64\r\n251250317049884, 342364698818618, 375149975146160 @ 132, -59, -48\r\n249580803401840, 262476177180933, 194655295156139 @ -29, -28, 14\r\n346927833316722, 296630154864065, 317808743635969 @ -15, -13, -10\r\n318119851570609, 267175537604062, 373326486739534 @ 79, 41, 10\r\n371943258073032, 375606760501958, 467849771432572 @ -16, -99, -160\r\n193041400251950, 284286801840653, 259815075990769 @ 201, -83, -161\r\n432656446036060, 324067817236989, 343462391335690 @ -120, -46, -32\r\n325134253843586, 181909849518821, 343763392792381 @ 78, 124, 49\r\n368232440638944, 265736449243829, 351337123754557 @ 13, 40, 13\r\n289651738361760, 258396906394689, 273459565875815 @ 11, 30, -24\r\n384508910077527, 254296230069161, 319393854443734 @ -83, 46, -26\r\n532443771311696, 240241487921271, 457321411501440 @ -140, 68, -78";

            var vectors = new List<((long x, long y, long z) p, (long vx, long vy, long vz) v)>();
            var lines = input.Replace("\r\n", "\n").Split('\n').ToList();
            foreach (var line in lines)
            {
                var data = line.Split('@');
                var coords = data[0].Split(',').Select(x => long.Parse(x.Trim())).ToArray();
                var vector = data[1].Split(',').Select(x => long.Parse(x.Trim())).ToArray();

                vectors.Add(((coords[0], coords[1], coords[2]), (vector[0], vector[1], vector[2])));
            }

            //int ok = CheckIntersections(vectors, 7, 27);
            int ok = CheckIntersections(vectors, 200000000000000, 400000000000000);
            Console.WriteLine(ok);


            for (int xx = -500; xx <= 500; xx++)
            {
                for (int yy = -500; yy <= 500; yy++)
                {
                    var matches = new Dictionary<(long x, long y), int>();
                    for (int j = 1; j < vectors.Count; j++)
                    {
                        var hailstoneA = (vectors[0].p, (vectors[0].v.vx - xx, vectors[0].v.vy - yy, vectors[0].v.vz));
                        var hailstoneB = (vectors[j].p, (vectors[j].v.vx - xx, vectors[j].v.vy - yy, vectors[j].v.vz));
                        (double x, double y) = FindIntersection(hailstoneA, hailstoneB);
                        if (x % 1 == 0 && y % 1 == 0)
                        {
                            if (!matches.ContainsKey(((long)x, (long)y)))
                                matches[((long)x, (long)y)] = 0;
                            matches[((long)x, (long)y)]++;
                            if (matches.Count > 1)
                            {
                                break;
                            }
                        }
                        else
                        {
                            break;
                        }
                        if (/*j == vectors.Count - 1 &&*/j >1&& matches.Count == 1)
                        {
                            Debugger.Launch();
                            Console.WriteLine(j + "YAY");
                        }
                    }

                    if (matches.Count == 1 /*&& matches.First().Value == vectors.Count - 1*/)
                    {
                        (long x, long y) = matches.Keys.First();
                        //Console.WriteLine($"{x} {y}: ");
                        for (int zz = -500; zz <= 500; zz++)
                        {
                            var zs = new HashSet<long>();
                            for (int j = 1; j < vectors.Count; j++)
                            {
                                var hailstoneA = (vectors[0].p, (vectors[0].v.vx - xx, vectors[0].v.vy - yy, vectors[0].v.vz - zz));
                                var hailstoneB = (vectors[j].p, (vectors[j].v.vx - xx, vectors[j].v.vy - yy, vectors[j].v.vz - zz));

                                long tempXA = hailstoneA.p.x;
                                long tempXB = hailstoneB.p.x;
                                long tempVXA = hailstoneA.Item2.Item1;
                                long tempVXB = hailstoneB.Item2.Item1;
                                hailstoneA.p.x = hailstoneA.p.z;
                                hailstoneB.p.x = hailstoneB.p.z;
                                hailstoneA.Item2.Item1 = hailstoneA.Item2.Item3;
                                hailstoneB.Item2.Item1 = hailstoneB.Item2.Item3;
                                (double z, double y2) = FindIntersection(hailstoneA, hailstoneB);

                                hailstoneA.p.y = tempXA;
                                hailstoneB.p.y = tempXB;
                                hailstoneA.Item2.Item2 = tempVXA;
                                hailstoneB.Item2.Item2 = tempVXB;
                                (double z2, double x2) = FindIntersection(hailstoneA, hailstoneB);

                                // TODO - double inaccuracy...
                                //		x	191537613659010	double
                                //      y   238270932096689 double
                                //      z2  137106090006865 double
                                //      x + y + z2  566914635762564 double
                                if (z % 1 == 0 && z == z2 && x == x2 && y == y2)
                                {
                                    zs.Add((long)z);
                                    if (zs.Count > 1)
                                        break;
                                    if (j == vectors.Count - 1)
                                    {
                                        Console.WriteLine($"{x} {y} {z}: {x + y + z}");
                                        return;
                                    }
                                }
                                else
                                {
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }

        private static int CheckIntersections(List<((long x, long y, long z) p, (long vx, long vy, long vz) v)> vectors, long min, long max)
        {
            int ok = 0;
            for (int i = 0; i < vectors.Count - 1; i++)
            {
                for (int j = i + 1; j < vectors.Count; j++)
                {
                    var hailstoneA = vectors[i];
                    var hailstoneB = vectors[j];
                    (double x, double y) = FindIntersection(hailstoneA, hailstoneB);

                    if (BetweenLimits(x, y, min, max) && SameDirection(hailstoneA, x) && SameDirection(hailstoneB, x))
                        ok++;
                }
            }

            return ok;
        }

        private static (double x, double y) FindIntersection(((decimal x, decimal y, decimal z) p, (decimal vx, decimal vy, decimal vz) v) hailstoneA, ((decimal x, decimal y, decimal z) p, (decimal vx, decimal vy, decimal vz) v) hailstoneB)
        {
            decimal div = (hailstoneB.v.vx * hailstoneA.v.vy) - (hailstoneA.v.vx * hailstoneB.v.vy);
            if (div == 0)
                return (double.PositiveInfinity, double.PositiveInfinity);
            double x = (double)((hailstoneB.p.y * hailstoneA.v.vx * hailstoneB.v.vx)
                    - (hailstoneB.p.x * hailstoneB.v.vy * hailstoneA.v.vx)
                    - (hailstoneA.p.y * hailstoneA.v.vx * hailstoneB.v.vx) 
                    + (hailstoneA.p.x * hailstoneA.v.vy * hailstoneB.v.vx))
                / (double)(div);

            double y = (double)((hailstoneB.p.y * hailstoneA.v.vy * hailstoneB.v.vx)
                    - (hailstoneB.p.x * hailstoneB.v.vy * hailstoneA.v.vy)
                    - (hailstoneA.p.y * hailstoneA.v.vx * hailstoneB.v.vy) 
                    + (hailstoneA.p.x * hailstoneA.v.vy * hailstoneB.v.vy))
                / (double)(div);

            return (x, y);
        }

        private static bool BetweenLimits(double x, double y, long min, long max)
        {
            return x >= min && x <= max && y >= min && y <= max;
        }

        private static bool SameDirection(((long x, long y, long z) p, (long vx, long vy, long vz) v) hailstone, double x)
        {
            return ((x - hailstone.p.x) > 0 && hailstone.v.vx > 0) || ((x - hailstone.p.x) < 0 && hailstone.v.vx < 0);
        }
    }
}
