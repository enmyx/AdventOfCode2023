using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml.Linq;

namespace Day23
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var sinput = "#.#####################\r\n#.......#########...###\r\n#######.#########.#.###\r\n###.....#.>.>.###.#.###\r\n###v#####.#v#.###.#.###\r\n###.>...#.#.#.....#...#\r\n###v###.#.#.#########.#\r\n###...#.#.#.......#...#\r\n#####.#.#.#######.#.###\r\n#.....#.#.#.......#...#\r\n#.#####.#.#.#########v#\r\n#.#...#...#...###...>.#\r\n#.#.#v#######v###.###v#\r\n#...#.>.#...>.>.#.###.#\r\n#####v#.#.###v#.#.###.#\r\n#.....#...#...#.#.#...#\r\n#.#########.###.#.#.###\r\n#...###...#...#...#.###\r\n###.###.#.###v#####v###\r\n#...#...#.#.>.>.#.>.###\r\n#.###.###.#.###.#.#v###\r\n#.....###...###...#...#\r\n#####################.#";
            var input = "#.###########################################################################################################################################\r\n#.#.....###.......#...#.....#.......#.........###...#...###...#.........#.....#...#.......#.........#...#...###.......#...#.................#\r\n#.#.###.###.#####.#.#.#.###.#.#####.#.#######.###.#.#.#.###.#.#.#######.#.###.#.#.#.#####.#.#######.#.#.#.#.###.#####.#.#.#.###############.#\r\n#...#...#...#.....#.#.#.#...#...#...#...#.....#...#.#.#...#.#.#...#...#.#.#...#.#.#...#...#.....#...#.#.#.#...#.....#.#.#.#...#.......#.....#\r\n#####.###.###.#####.#.#.#.#####.#.#####.#.#####.###.#.###.#.#.###.#.#.#.#.#.###.#.###.#.#######.#.###.#.#.###.#####.#.#.#.###.#.#####.#.#####\r\n#.....###...#...#...#.#.#.#####.#.###...#...###...#.#...#.#.#...#...#.#.#.#.#...#.#...#...###...#.###.#.#.#...###...#.#.#.#...#.....#.#.....#\r\n#.#########.###.#.###.#.#.#####.#.###.#####.#####.#.###.#.#.###.#####.#.#.#.#.###.#.#####.###.###.###.#.#.#.#####.###.#.#.#.#######.#.#####.#\r\n#.........#.#...#...#.#.#.#.>.>.#.###.#.....#...#.#.#...#...#...###...#...#.#...#.#.....#...#...#.#...#...#...#...###...#...#.......#.......#\r\n#########.#.#.#####.#.#.#.#.#v###.###.#.#####.#.#.#.#.#######.#####.#######.###.#.#####.###.###.#.#.#########.#.#############.###############\r\n#.........#.#...#...#...#.#.#.###...#.#.#...#.#.#.#.#.....#...#...#.......#.#...#.#...#...#...#.#.#.#.......#.#.#.......#...#.........#.....#\r\n#.#########.###.#.#######.#.#.#####.#.#.#.#.#.#.#.#.#####.#.###.#.#######.#.#.###.#.#.###.###.#.#.#.#.#####.#.#.#.#####.#.#.#########.#.###.#\r\n#.#...#...#.###.#.......#.#.#.#.....#.#.#.#.#.#.#.#.#...#.#.###.#.#...#...#.#.#...#.#.###.#...#.#.#...#.....#...#.....#...#...........#...#.#\r\n#.#.#.#.#.#.###v#######.#.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.###.#.#.###.#.###.#.###.#.#####.#############.###################.#.#\r\n#.#.#.#.#...###.>.......#...#.#...#...#.#.#.#.#.#.#.#.#...#.>.>.#...#.#.#...#.#.#...#...#.#...#.#.>.>.#.#.......#.....#.....#...#.....###.#.#\r\n#.#.#.#.#######v#############.###.#.###.#.#.#.#.#.#.#.#######v#######.#.#.###.#.#.#####.#.###.#.###v#.#.#.#####.#.#####.###.#.#.#.###.###.#.#\r\n#.#.#.#.#...#...#...#.........###.#.###.#.#.#.#.#.#...#.......#.....#.#.#.>.>.#.#.#...#.#.###.#.###.#...#...#...#.....#.#...#.#.#.#...#...#.#\r\n#.#.#.#.#.#.#.###.#.#.###########.#.###.#.#.#.#.#.#####.#######.###.#.#.###v###.#.#.#.#.#.###.#.###.#######.#.#######.#.#.###.#.#.#.###.###.#\r\n#.#.#.#.#.#.#.....#.#...........#.#...#...#.#.#.#.....#.......#.#...#.#.###...#...#.#.#.#...#.#...#.#...#...#.....###...#.....#...#.....#...#\r\n#.#.#.#.#.#.#######.###########.#.###.#####.#.#.#####.#######.#.#.###.#.#####.#####.#.#.###.#.###.#.#.#.#.#######.#######################.###\r\n#.#.#.#.#.#...###...#...........#.....#.....#.#...#...#...###...#...#...#####...###.#.#.#...#.#...#.#.#...###...#.#...#...#...#.....#.....###\r\n#.#.#.#.#.###.###.###.#################.#####.###.#.###.#.#########.###########.###.#.#.#.###.#.###.#.#######.#.#.#.#.#.#.#.#.#.###.#.#######\r\n#...#.#.#...#.....###.................#.....#...#.#.#...#...#...###.........###...#.#.#.#.#...#...#.#.#.....#.#...#.#...#...#.#...#.#.......#\r\n#####.#.###.#########################.#####.###.#.#.#.#####.#.#.###########.#####.#.#.#.#.#.#####.#.#.#.###.#.#####.#########.###.#.#######.#\r\n#.....#.###...#...###.................#...#.#...#...#.....#.#.#.###...#...#.#.....#.#.#...#.....#.#...#...#.#...###.........#.#...#.......#.#\r\n#.#####.#####.#.#.###.#################.#.#.#.###########.#.#.#.###.#.#.#.#.#.#####.#.#########.#.#######.#.###.###########.#.#.#########.#.#\r\n#.#.....#...#...#...#.........#...#...#.#.#...#...........#...#.....#...#...#.......#...###...#...###.....#.....#...........#...#.....#...#.#\r\n#.#.#####.#.#######.#########.#.#.#.#.#.#.#####.#######################################.###.#.#######.###########.###############.###.#.###.#\r\n#...#...#.#.........#...#####...#...#...#...###.......#.....#...#...###...#...#.........#...#...#...#.........###.................#...#...#.#\r\n#####.#.#.###########.#.###################.#########.#.###.#.#.#.#.###.#.#.#.#.#########.#####.#.#.#########.#####################.#####.#.#\r\n#.....#...#...#...#...#...#...........#.....#...#...#...###...#...#...#.#.#.#.#...#...###.#.....#.#.....#####.....#...........#...#.#####...#\r\n#.#########.#.#.#.#.#####.#.#########.#.#####.#.#.#.#################.#.#.#.#.###v#.#.###.#.#####.#####.#########.#.#########.#.#.#.#########\r\n#.#...#.....#.#.#.#...#...#.........#...#...#.#...#.#...#...###.......#.#...#...>.>.#.#...#.....#.....#.#.........#.........#...#.#...#.....#\r\n#.#.#.#.#####.#.#v###.#.###########.#####.#.#.#####.#.#.#.#.###.#######.#########v###.#.#######.#####.#.#.#################.#####.###.#.###.#\r\n#...#...###...#.#.>.#.#...#.......#.#...#.#.#.....#...#.#.#.#...#...###.....#.....###...#.......#...#.#.#.........#...#...#.....#.....#.#...#\r\n###########.###.#v#.#.###.#.#####.#.#.#.#.#.#####.#####.#.#.#.###.#.#######.#.###########.#######.#.#.#.#########.#.#.#.#.#####.#######.#.###\r\n###...#...#.....#.#.#.#...#...###...#.#.#.#.#...#.....#.#.#.#.#...#.#.......#.....#.....#...#.....#.#.#.#.........#.#.#.#.#.....###...#.#.###\r\n###.#.#.#.#######.#.#.#.#####v#######.#.#.#.#.#.#####.#.#.#.#.#.###.#.###########.#.###.###.#.#####.#.#.#.#########.#.#.#.#v#######.#.#.#.###\r\n#...#...#.........#.#.#.....>.>.#...#.#.#.#.#.#.#...#.#.#.#.#...###.#.........#...#.#...#...#.....#.#.#.#.....#...#.#.#.#.>.#...#...#...#...#\r\n#.#################.#.#######v#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#######v#########.#.###.#.###.#######.#.#.#.#####v#.#.#.#.#.###v#.#.#.#########.#\r\n#...#.............#.#.....#...#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.....>.>.#.....#.#...#.#...#.......#.#...#.....>.>.#.#.#.#.#...#.#.#...#.......#\r\n###.#.###########.#.#####.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#####v#.#.###.#.###.#.###.#######.#.###########v###.#.#.#.#.###.#.###.#.#######\r\n#...#.#.....#.....#...#...#.......#.#.#...#.#.#.#.#...#.#.#...#...#.#.#.###...###.#.###.......#.#.#.........#...#.#.#.#.#...#.#.....#.....###\r\n#.###.#.###.#.#######.#.#########.#.#.#####.#.#.#.#####.#.#####.#.#.#.#.#########.#.#########.#.#.#.#######.###.#.#.#.#.###.#.###########.###\r\n#...#.#...#.#.......#.#.#.........#.#...#...#.#.#.....#...#...#.#...#...#...#####...#.....#...#...#.......#.#...#.#.#...#...#.#.....#...#...#\r\n###.#.###.#.#######.#.#.#.#########.###.#.###.#.#####.#####.#.#.#########.#.#########.###.#.#############.#.#.###.#.#####.###.#.###.#.#.###.#\r\n#...#.#...#.#.......#...#.........#...#.#.#...#...#...#.....#.#.......#...#...###...#...#.#.....#...#.....#.#.###...#...#.....#...#...#.....#\r\n#.###.#.###.#.###################.###.#.#.#.#####.#.###.#####.#######.#.#####.###.#.###.#.#####.#.#.#.#####.#.#######.#.#########.###########\r\n#.....#...#.#...#...###...........###.#.#...#...#...###.....#...#.....#.....#.....#.....#...#...#.#.#.....#.#.......#.#...........#...#...###\r\n#########.#.###.#.#.###.#############.#.#####.#.###########.###.#.#########.###############.#.###.#.#####.#.#######.#.#############.#.#.#.###\r\n#...#.....#.....#.#...#...#.........#...#...#.#...#...#...#.###...#.....#...#.....#.....###...#...#.......#.........#.#...#.......#.#.#.#...#\r\n#.#.#.###########.###.###.#.#######.#####.#.#.###.#.#.#.#.#.#######.###.#.###.###.#.###.#######.#####################.#.#.#.#####.#.#.#.###.#\r\n#.#...#.....#...#.#...###...#...#...#...#.#.#.#...#.#.#.#.#.......#.#...#.#...###...###...#.....#.........#...#...#...#.#.#...#...#.#.#.#...#\r\n#.#####.###.#.#.#.#.#########.#.#.###.#.#.#.#.#.###.#.#.#.#######.#.#.###.#.#############.#.#####.#######.#.#.#.#.#.###.#.###.#.###.#.#.#.###\r\n#.......###...#...#...#.......#...###.#.#.#...#...#.#.#.#.#.......#.#...#.#...#...........#.....#.#.....#.#.#.#.#.#.....#.....#...#.#...#...#\r\n#####################.#.#############.#.#.#######.#.#.#.#.#v#######.###.#.###.#.###############.#.#.###.#.#.#.#.#.###############.#.#######.#\r\n#...........###.......#...........#...#.#.......#.#.#...#.>.>.#.....#...#.....#...............#.#.#...#...#.#.#.#.#...#...#.......#.#.......#\r\n#.#########.###.#################.#.###.#######.#.#.#######v#.#.#####.#######################.#.#.###.#####.#.#.#.#.#.#.#.#.#######.#.#######\r\n#.#...#...#...#.......#...#.......#...#.......#.#.#.#.....#.#.#...#...###...###...#...#.......#...###...#...#...#.#.#.#.#.#.......#.#.......#\r\n#.#.#.#.#.###.#######.#.#.#.#########.#######.#.#.#.#.###.#.#.###.#.#####.#.###.#.#.#.#v###############.#.#######.#.#.#.#.#######.#.#######.#\r\n#...#...#...#.........#.#.#...###...#.......#.#.#.#.#...#.#.#...#.#...#...#.#...#.#.#.>.>.#...#...###...#...#.....#.#.#.#.#.....#...###.....#\r\n###########.###########.#.###.###.#.#######.#.#.#.#.###.#.#.###.#.###.#.###.#.###.#.###v#.#.#.#.#.###.#####.#.#####.#.#.#.#.###.#######.#####\r\n#.........#.....#.....#.#.#...#...#.#...#...#...#...#...#...###...#...#...#.#.#...#.#...#.#.#.#.#...#.#.....#.......#.#.#.#.#...###...#.....#\r\n#.#######.#####.#.###.#.#.#.###.###.#.#.#.###########.#############.#####.#.#.#.###.#.###.#.#.#.###.#.#.#############.#.#.#.#.#####.#.#####.#\r\n#.......#.......#.#...#.#.#...#...#.#.#...#####...###.............#.....#.#.#.#.#...#.###.#.#.#.#...#.#...#...........#.#...#.#...#.#.#.....#\r\n#######.#########.#v###.#.###v###.#.#.#########.#.###############.#####.#.#.#.#.#.###.###.#.#.#.#.###v###.#.###########.#####.#.#.#.#.#.#####\r\n#.......#.......#.#.>.#.#...>.>.#.#.#.###.......#.......#.........#.....#.#.#.#...###...#.#.#...#...>.>.#.#.###...#...#...#...#.#.#.#.#...###\r\n#.#######.#####.#.#v#.#.#####v#.#.#.#.###.#############.#.#########.#####.#.#.#########.#.#.#########v#.#.#.###.#.#.#.###.#.###.#.#.#.###v###\r\n#.....#...#...#...#.#.#...#...#...#.#...#.#...#...#...#...#.......#...#...#...#...#...#.#.#.#.........#...#...#.#.#.#.#...#.#...#.#.#.#.>.###\r\n#####.#.###.#.#####.#.###.#.#######.###.#.#.#.#.#.#.#.#####.#####.###.#.#######.#.#.#.#.#.#.#.###############.#.#.#.#.#.###.#.###.#.#.#.#v###\r\n#...#...###.#.......#.....#.......#.....#...#...#...#.......#...#.###...###.....#...#...#...#.#...#...###.....#.#.#.#...###...#...#.#...#...#\r\n#.#.#######.#####################.###########################.#.#.#########.#################.#.#.#.#.###.#####.#.#.###########.###.#######.#\r\n#.#.###...#...............#...#...#.........#.................#...#...#...#.................#.#.#...#...#.......#...#...#.....#.....#.....#.#\r\n#.#.###.#.###############.#.#.#.###.#######.#.#####################.#.#.#.#################.#.#.#######.#############.#.#.###.#######.###.#.#\r\n#.#.#...#...#...#.........#.#.#.###.#.......#...............#.......#.#.#.........#.........#...#...###.....#.....###.#.#.#...#...#...#...#.#\r\n#.#.#.#####.#.#.#v#########.#.#v###.#.#####################.#.#######.#.#########.#.#############.#.#######.#.###.###.#.#.#.###.#.#v###.###.#\r\n#.#.#.#...#...#.#.>...#...#.#.>.>...#.###...#.....#.........#.....#...#.........#...#.........#...#.........#...#...#.#...#.#...#.>.###...#.#\r\n#.#.#.#.#.#####.#v###.#.#.#.###v#####.###.#.#.###.#.#############.#.###########.#####.#######.#.###############.###.#.#####.#.#####v#####.#.#\r\n#.#.#...#...#...#...#.#.#.#.###.....#...#.#.#.#...#.....#...###...#.#...#.....#.....#.#.......#.#.........#####...#.#...###...#...#...#...#.#\r\n#.#.#######.#.#####.#.#.#.#.#######.###.#.#.#.#.#######.#.#.###.###.#.#.#.###.#####.#.#.#######.#.#######.#######.#.###.#######.#.###.#.###.#\r\n#.#.#...#...#.......#...#...#.......###.#.#.#.#...#.....#.#...#.#...#.#.#.#...#...#.#.#.......#.#...#.....#.....#.#.#...#.......#...#.#...#.#\r\n#.#.#.#.#.###################.#########.#.#.#.###.#.#####.###.#.#.###.#.#.#.###.#.#v#.#######.#.###.#.#####.###.#.#.#.###.#########.#.###.#.#\r\n#.#...#.#...#.....#...#...#...#...#...#...#.#.#...#.....#.#...#.#.###.#.#.#.#...#.>.>.#.......#.....#.....#...#...#.#.#...#.......#...#...#.#\r\n#.#####.###.#.###.#.#.#.#.#.###.#.#.#.#####.#.#.#######.#.#.###.#.###.#.#.#.#.#####v###.#################.###.#####.#.#.###.#####.#####.###.#\r\n#.#...#.###...###...#...#.#.....#...#...#...#.#.#...#...#.#.....#...#.#.#.#.#.#####.#...###.....#...#####...#.....#.#.#.#...#.....#...#...#.#\r\n#.#.#.#.#################.#############.#.###.#.#.#.#.###.#########.#.#.#.#.#.#####.#.#####.###.#.#.#######.#####.#.#.#.#.###.#####.#.###.#.#\r\n#...#.#...................#.............#...#.#...#.#.###.###...#...#.#.#.#.#.#.....#.....#.#...#.#.###...#.###...#...#.#.#...#...#.#.###...#\r\n#####.#####################.###############.#.#####.#.###.###.#.#.###.#.#.#.#.#.#########.#.#.###.#.###.#.#v###.#######.#.#.###.#.#.#.#######\r\n#...#.............#...#...#.........#...###...###...#.#...#...#...#...#...#...#.......#...#.#...#.#.....#.>.>.#.......#...#.....#...#.......#\r\n#.#.#############.#.#.#.#.#########.#.#.#########.###v#.###.#######.#################.#.###.###.#.#########v#.#######.#####################.#\r\n#.#.....#...#...#...#...#...###.....#.#.......#...#.>.>.###...#...#.....#.............#...#.#...#...#.......#...#...#...#...................#\r\n#.#####.#.#.#.#.###########.###.#####.#######.#.###.#v#######.#.#.#####.#.###############.#.#.#####.#.#########.#.#.###.#.###################\r\n#.#...#...#...#.....#.....#...#.#.....#.......#.....#...#...#...#.#...#.#.......#...#...#.#.#.#...#.#.#...#...#...#.#...#.........#.........#\r\n#.#.#.#############.#.###.###.#.#.#####.###############.#.#.#####.#.#.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#####.#.###########.#.#######.#\r\n#.#.#.....#.......#...###.#...#...#...#...........#...#...#.....#...#...###.....#.#...#.#.#.#.#.#.#.#.#.#...#.....#.#...#.......#...#.......#\r\n#.#.#####.#.#####.#######.#.#######.#.###########.#.#.#########.###########.#####.#####.#.#.#.#.#.#.#.#.#########.#.###.#.#####.#####.#######\r\n#.#.#.....#.#.....###...#...#...#...#.............#.#...........###...#...#.......#.....#.#.#.#.#...#...#.....#...#.....#.....#.....#.....###\r\n#.#.#.#####.#.#######.#.#####.#.#.#################.###############.#.#.#.#########.#####.#.#.#.#########.###.#.#############.#####.#####.###\r\n#...#.......#.........#.....#.#.#...#...#.........#.#.........#...#.#.#.#.#...#...#.#...#...#.#...#.......###...#.......#####.....#.#...#...#\r\n###########################.#.#.###.#.#.#.#######.#.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#####.###.#.#############.#####.#########.#.#.#.###.#\r\n###...................#.....#.#...#...#...#...#...#...#.......#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.....#...........###.....#...#.......#...#.....#\r\n###.#################.#.#####.###.#########.#.#.#######.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#################.#######.###.#.#################\r\n#...#.....#.........#.#.#...#.#...#...#.....#...###.....#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#####...#...#.....###...#.#...#.............#\r\n#.###.###.#.#######.#.#.#.#.#.#.###.#.#.###########.#####.###.#.#.#.#.#.#.#.#.#.#.#v#.#.#.#.#.#.#####.#.#.#.#####.#####.#.###.#.###########.#\r\n#.....###...###.....#...#.#.#.#...#.#.#...........#.......#...#.#.#.#.#.#.#.#.#.#.>.>.#...#...#...#...#...#.......#.....#...#...#...........#\r\n###############.#########.#.#.###.#.#.###########.#########.###.#.#.#.#.#.#.#.#.###v#############.#.###############.#######.#####.###########\r\n#...............#.....###.#.#...#...#.#...........#...#.....#...#.#.#...#.#.#.#.###.....#.........#...#.......#...#...#...#.......#...###...#\r\n#.###############.###.###.#.###.#####.#.###########.#.#.#####.###.#.#####.#.#.#.#######.#.###########.#.#####.#.#.###.#.#.#########.#.###.#.#\r\n#.#.............#...#...#.#.#...#.....#.......#...#.#.#.#...#...#.#.#.....#.#.#.....#...#.........###...#.....#.#.#...#.#.#...#...#.#.....#.#\r\n#.#.###########v###.###.#.#.#.###.###########.#.#.#.#.#v#.#.###.#.#.#.#####.#.#####.#.###########.#######.#####.#.#.###.#.#.#.#.#.#.#######.#\r\n#.#.#.........#.>.#.#...#.#.#...#.#.......#...#.#.#.#.>.>.#...#.#.#.#.....#.#.......#...#.........#...#...#...#.#.#.....#...#...#...#.......#\r\n#.#.#.#######.#v#.#.#.###.#.###.#.#.#####.#.###.#.#.###v#####.#.#.#.#####.#.###########.#.#########.#.#.###.#.#.#.###################.#######\r\n#.#.#.......#...#...#...#.#.###.#.#.#.....#.###.#...#...#...#...#...#.....#.###...#...#.#...###...#.#.#...#.#.#.#.#...#...###...#...#.......#\r\n#.#.#######.###########.#.#.###.#.#.#.#####v###.#####.###.#.#########.#####.###.#.#.#.#.###.###.#.#.#.###v#.#.#.#.#.#.#.#.###v#.#.#.#######.#\r\n#...###...#.#.........#.#.#.#...#.#.#.#...>.>.#.#...#.....#.......###.......#...#...#...###.....#.#.#.#.>.>.#.#.#.#.#.#.#...>.#.#.#.#...#...#\r\n#######.#.#.#.#######.#.#.#.#.###.#.#.#.###v#.#.#.#.#############.###########.###################.#.#.#.#v###.#.#.#.#.#.#####v#.#.#.#.#.#.###\r\n#.......#.#...#...#...#.#.#.#.###...#...#...#.#.#.#...............#...#...###.......#.........#...#.#...#...#.#.#.#.#.#...#...#...#...#...###\r\n#.#######.#####.#.#.###.#.#.#.###########.###.#.#.#################.#.#.#.#########.#.#######.#.###.#######.#.#.#.#.#.###.#.#################\r\n#.......#.......#...###...#.#.#...........###...#.................#.#.#.#.#...#...#.#.#.......#...#.....#...#...#...#...#.#.......#.....#...#\r\n#######.###################.#.#.#################################.#.#.#.#.#.#.#.#.#.#.#.#########.#####.#.#############.#.#######.#.###.#.#.#\r\n#...###.....#...........###...#.........#...#.....#...............#.#.#.#...#...#.#...#.........#.......#.............#...#...#...#.#...#.#.#\r\n#.#.#######.#.#########.###############.#.#.#.###.#.###############.#.#.#########.#############.#####################.#####.#.#.###.#.###.#.#\r\n#.#.......#.#.#.........#...#...#.....#...#...#...#.........#.......#.#...#.......###...........###.....#.............###...#.#.....#.....#.#\r\n#.#######.#.#.#.#########.#.#.#.#.###.#########.###########.#.#######.###.#.#########.#############.###.#.###############.###.#############.#\r\n#.......#...#.#.....###...#...#.#...#.#.........#...........#.......#.###.#.#...#...#...###...#...#.#...#...........#...#...#.#.............#\r\n#######.#####.#####.###.#######.###.#.#v#########.#################.#.###.#.#.#.#.#.###v###.#.#.#.#.#.#############.#.#.###.#.#.#############\r\n#.......#.....#...#...#.#.....#.....#.>.>...#...#.......#...#...#...#.#...#.#.#.#.#.#.>.>.#.#.#.#.#.#...#...#.......#.#.#...#.#.....#...#...#\r\n#.#######.#####.#.###.#.#.###.#############.#.#.#######.#.#.#.#.#.###.#.###.#.#.#.#.#.###.#.#.#.#.#.###.#.#.#.#######.#.#.###.#####.#.#.#.#.#\r\n#.#...#...#.....#.....#...###...........###.#.#.###...#.#.#.#.#.#.#...#.#...#.#.#.#.#...#.#.#.#.#.#.#...#.#.#...#...#.#.#...#...#...#.#.#.#.#\r\n#.#.#.#.###.###########################.###.#.#.###.#.#v#.#.#.#.#.#.###.#.###.#.#.#.###.#.#.#.#.#.#.#.###.#.###v#.#.#.#.###.###.#.###.#.#.#.#\r\n#.#.#.#.#...#...#.....###...#...#...#...#...#.#...#.#.>.>.#.#.#.#.#.#...#...#.#...#.#...#.#.#...#.#.#.#...#.#.>.>.#.#.#.###.#...#.....#.#.#.#\r\n#.#.#.#.#.###.#.#.###.###.#.#.#.#.#.#.###.###.###.#.#######.#.#.#.#.#.#####.#.#####.#.###.#.#####.#.#.#.###.#.#####.#.#.###.#.#########v#.#.#\r\n#.#.#...#.....#...#...#...#.#.#.#.#...###...#.###.#.#####...#.#...#.#...#...#...#...#...#.#.###...#.#.#.#...#...###.#.#.#...#...#...#.>.#.#.#\r\n#.#.###############.###.###.#.#.#.#########.#.###.#.#####.###.#####.###.#.#####.#.#####.#.#.###.###.#.#.#.#####.###.#.#.#.#####.#.#.#.#v#.#.#\r\n#.#.#...............#...#...#.#.#.....#.....#.#...#.....#...#...###...#.#.#...#.#...#...#...#...#...#...#...#...#...#.#.#.....#...#...#...#.#\r\n#.#.#.###############.###.###.#.#####.#.#####.#.#######.###.###.#####.#.#.#.#.#.###.#.#######.###.#########.#.###.###.#.#####.#############.#\r\n#...#.......#...#...#.###.#...#.#.....#.#...#.#...#.....###.#...#.....#.#.#.#...#...#.....#...#...#.........#...#...#.#.#...#.....#.........#\r\n###########.#.#.#.#.#.###.#.###.#.#####.#.#.#.###.#.#######.#.###.#####.#.#.#####.#######.#.###.###.###########.###.#.#.#.#.#####.#.#########\r\n#...........#.#.#.#.#...#.#.###.#...#...#.#.#.#...#.......#.#.#...#...#.#.#.#.....#...#...#...#...#.#.....#.....#...#.#.#.#.#...#.#...#.....#\r\n#.###########.#.#.#.###.#.#.###.###.#.###.#.#.#.#########.#.#.#.###.#.#.#.#.#.#####.#.#.#####.###.#.#.###.#.#####.###.#.#.#.#.#.#.###.#.###.#\r\n#.............#...#.....#...###.....#.....#...#...........#...#.....#...#...#.......#...#####.....#...###...#####.....#...#...#...###...###.#\r\n###########################################################################################################################################.#";
            var lines = input.Replace("\r\n", "\n").Split('\n').ToList();

            var map = new char[lines.Count, lines[0].Length];
            (int x, int y) start = (-1, -1);
            (int x, int y) end = (-1, -1);
            for (int y = 0; y < lines.Count; y++)
            {
                for (int x = 0; x < lines[y].Length; x++)
                {
                    if (y == 0 && lines[y][x] == '.')
                        start = (x, y);
                    else if (y == lines.Count - 1 && lines[y][x] == '.')
                        end = (x, y);

                    map[y, x] = lines[y][x];
                }
            }

            Part1(map, start, end);
            Part2(map, start, end);
        }

        private static void Part1(char[,] map, (int x, int y) start, (int x, int y) end)
        {
            var queue = new Queue<((int x, int y), (int x, int y) from)>();
            queue.Enqueue((start, (-1, -1)));
            var path = new Dictionary<(int x, int y), int>
            {
                [start] = 0
            };

            while (queue.Count > 0)
            {
                var ((x, y), from) = queue.Dequeue();
                int newDist = path[(x, y)] + 1;

                if (x - 1 >= 0 && (x - 1, y) != from && (map[y, x - 1] == '.' || map[y, x - 1] == '<'))
                    AddIfHigher(queue, path, x - 1, y, newDist, end, (x, y));
                if (x + 1 < map.GetLength(1) && (x + 1, y) != from && (map[y, x + 1] == '.' || map[y, x + 1] == '>'))
                    AddIfHigher(queue, path, x + 1, y, newDist, end, (x, y));
                if (y - 1 >= 0 && (x, y - 1) != from && (map[y - 1, x] == '.' || map[y - 1, x] == '^'))
                    AddIfHigher(queue, path, x, y - 1, newDist, end, (x, y));
                if (y + 1 < map.GetLength(0) && (x, y + 1) != from && (map[y + 1, x] == '.' || map[y + 1, x] == 'v'))
                    AddIfHigher(queue, path, x, y + 1, newDist, end, (x, y));
            }

            Console.WriteLine(path[end]);
        }

        private static void Part2(char[,] map, (int x, int y) start, (int x, int y) end)
        {
            var nodes = new Dictionary<(int x, int y), Node>();
            for (int y = 0; y < map.GetLength(0); y++)
                for (int x = 0; x < map.GetLength(1); x++)
                    if (map[y, x] != '#')
                        nodes.Add((x, y), new Node());

            for (int y = 0; y < map.GetLength(0); y++)
                for (int x = 0; x < map.GetLength(1); x++)
                    if (nodes.ContainsKey((x, y)))
                    {
                        var node = nodes[(x, y)];
                        if (nodes.ContainsKey((x - 1, y)))
                            node.Neighbors.Add(nodes[(x - 1, y)], 1);
                        if (nodes.ContainsKey((x + 1, y)))
                            node.Neighbors.Add(nodes[(x + 1, y)], 1);
                        if (nodes.ContainsKey((x, y - 1)))
                            node.Neighbors.Add(nodes[(x, y - 1)], 1);
                        if (nodes.ContainsKey((x, y + 1)))
                            node.Neighbors.Add(nodes[(x, y + 1)], 1);
                    }

            ReduceNodes(nodes);

            var stack = new Stack<(Node node, HashSet<Node> visited, int length)>();
            stack.Push((nodes[start], new HashSet<Node>(), 0));

            int max = 0;
            while (stack.Count > 0)
            {
                var (node, visited, length) = stack.Pop();
                if (node == nodes[end])
                {
                    max = Math.Max(max, length);
                    continue;
                }

                foreach (var neighbor in node.Neighbors.Where(n => !visited.Contains(n.Key)))
                    stack.Push((neighbor.Key, new HashSet<Node>(visited) { node }, length + neighbor.Value));

            }

            Console.WriteLine(max);
        }

        private static void ReduceNodes(Dictionary<(int x, int y), Node> nodes)
        {
            while (nodes.Any(n => n.Value.Neighbors.Count == 2))
            {
                var nodeData = nodes.First(n => n.Value.Neighbors.Count == 2);
                var node = nodeData.Value;
                var neighbors = node.Neighbors.ToList();
                var a = neighbors[0].Key;
                var b = neighbors[1].Key;

                int aToNode = a.Neighbors[node];
                int bToNode = b.Neighbors[node];
                a.Neighbors.Remove(node);
                b.Neighbors.Remove(node);
                int dist = aToNode + bToNode;
                a.Neighbors[b] = dist;
                b.Neighbors[a] = dist;

                nodes.Remove(nodeData.Key);
            }
        }

        private static void AddIfHigher(Queue<((int x, int y), (int, int) from)> queue, Dictionary<(int x, int y), int> path, int x, int y, int newDist, (int x, int y) end, (int x, int y) from)
        {
            if (!path.ContainsKey((x, y)) || path[(x, y)] < newDist)
            {
                path[(x, y)] = newDist;
                if ((x, y) != end)
                    queue.Enqueue(((x, y), from));
            }
        }
    }

    class Node
    {
        public Dictionary<Node, int> Neighbors { get; set; } = new Dictionary<Node, int>();
    }
}
